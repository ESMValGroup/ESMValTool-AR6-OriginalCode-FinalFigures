# ESMValTool
# recipe_ar6ch3_globalmonsoon.yml
---
documentation:

  description: |
    Producing selected figures from IPCC WGI AR6, chap. 3

  authors:
    - kosaka_yu

#  maintainer:
    
  references:
   - acknow_project

  projects:
    - ipcc_ar6

  realms:
    - atmos

  themes:
    - monsoon

  domains:
    - trop
    - midlat

  plot_types:
    - geo
    - times

  statistics:
    - clim
    - anomaly

datasets:
    - {dataset: BCC-CSM2-MR, ensemble: r1i1p1f1, grid: gn}
#    - {dataset: BCC-CSM2-MR, ensemble: r2i1p1f1, grid: gn}
#    - {dataset: BCC-CSM2-MR, ensemble: r3i1p1f1, grid: gn}
    - {dataset: BCC-ESM1, ensemble: r1i1p1f1, grid: gn}
#    - {dataset: BCC-ESM1, ensemble: r2i1p1f1, grid: gn}
#    - {dataset: BCC-ESM1, ensemble: r3i1p1f1, grid: gn}
    - {dataset: CAMS-CSM1-0, ensemble: r1i1p1f1, grid: gn}
#    - {dataset: CAMS-CSM1-0, ensemble: r2i1p1f1, grid: gn}
    - {dataset: CESM2, ensemble: r1i1p1f1, grid: gn}
#    - {dataset: CESM2, ensemble: r2i1p1f1, grid: gn}
#    - {dataset: CESM2, ensemble: r3i1p1f1, grid: gn}
#    - {dataset: CESM2, ensemble: r4i1p1f1, grid: gn}
#    - {dataset: CESM2, ensemble: r5i1p1f1, grid: gn}
#    - {dataset: CESM2, ensemble: r6i1p1f1, grid: gn}
#    - {dataset: CESM2, ensemble: r7i1p1f1, grid: gn}
#    - {dataset: CESM2, ensemble: r8i1p1f1, grid: gn}
#    - {dataset: CESM2, ensemble: r9i1p1f1, grid: gn}
#    - {dataset: CESM2, ensemble: r11i1p1f1, grid: gn}
    - {dataset: CESM2-WACCM, ensemble: r1i1p1f1, grid: gn}
#    - {dataset: CESM2-WACCM, ensemble: r2i1p1f1, grid: gn}
#    - {dataset: CESM2-WACCM, ensemble: r3i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r1i1p1f1, grid: gn}
    - {dataset: CNRM-CM6-1, ensemble: r1i1p1f2, grid: gr}
#    - {dataset: CNRM-CM6-1, ensemble: r2i1p1f2, grid: gr}
#    - {dataset: CNRM-CM6-1, ensemble: r3i1p1f2, grid: gr}
#    - {dataset: CNRM-CM6-1, ensemble: r4i1p1f2, grid: gr}
#    - {dataset: CNRM-CM6-1, ensemble: r5i1p1f2, grid: gr}
#    - {dataset: CNRM-CM6-1, ensemble: r6i1p1f2, grid: gr}
#    - {dataset: CNRM-CM6-1, ensemble: r7i1p1f2, grid: gr}
#    - {dataset: CNRM-CM6-1, ensemble: r8i1p1f2, grid: gr}
#    - {dataset: CNRM-CM6-1, ensemble: r9i1p1f2, grid: gr}
#    - {dataset: CNRM-CM6-1, ensemble: r10i1p1f2, grid: gr}
    - {dataset: CNRM-ESM2-1, ensemble: r1i1p1f2, grid: gr}
#    - {dataset: CNRM-ESM2-1, ensemble: r2i1p1f2, grid: gr}
#    - {dataset: CNRM-ESM2-1, ensemble: r3i1p1f2, grid: gr}
#    - {dataset: CNRM-ESM2-1, ensemble: r4i1p1f2, grid: gr}
#    - {dataset: CNRM-ESM2-1, ensemble: r5i1p1f2, grid: gr}
#    - {dataset: E3SM-1-0, ensemble: r1i1p1f1, grid: gr} ; Failed in ua due to incorrect missing value
#    - {dataset: E3SM-1-0, ensemble: r2i1p1f1, grid: gr}
#    - {dataset: E3SM-1-0, ensemble: r3i1p1f1, grid: gr}
#    - {dataset: E3SM-1-0, ensemble: r4i1p1f1, grid: gr}
#    - {dataset: E3SM-1-0, ensemble: r5i1p1f1, grid: gr}
    - {dataset: EC-Earth3, ensemble: r1i1p1f1, grid: gr}
#    - {dataset: EC-Earth3, ensemble: r2i1p1f1, grid: gr}
#    - {dataset: EC-Earth3, ensemble: r3i1p1f1, grid: gr}
#    - {dataset: EC-Earth3, ensemble: r4i1p1f1, grid: gr}
#    - {dataset: EC-Earth3, ensemble: r6i1p1f1, grid: gr}
#    - {dataset: EC-Earth3, ensemble: r9i1p1f1, grid: gr}
#    - {dataset: EC-Earth3, ensemble: r11i1p1f1, grid: gr}
#    - {dataset: EC-Earth3, ensemble: r13i1p1f1, grid: gr}
#    - {dataset: EC-Earth3, ensemble: r14i1p1f1, grid: gr}
#    - {dataset: EC-Earth3, ensemble: r15i1p1f1, grid: gr}
#    - {dataset: EC-Earth3, ensemble: r17i1p1f1, grid: gr}
#    - {dataset: EC-Earth3, ensemble: r21i1p1f1, grid: gr}
#    - {dataset: EC-Earth3, ensemble: r22i1p1f1, grid: gr}
#    - {dataset: EC-Earth3, ensemble: r24i1p1f1, grid: gr}
    - {dataset: EC-Earth3-Veg, ensemble: r1i1p1f1, grid: gr}
#    - {dataset: EC-Earth3-Veg, ensemble: r3i1p1f1, grid: gr}
#    - {dataset: EC-Earth3-Veg, ensemble: r4i1p1f1, grid: gr}
#    - {dataset: FGOALS-f3-L, ensemble: r1i1p1f1, grid: gr}
    - {dataset: FGOALS-g3, ensemble: r1i1p1f1, grid: gn}
    - {dataset: GFDL-CM4, ensemble: r1i1p1f1, grid: gr1}
    - {dataset: GFDL-ESM4, ensemble: r1i1p1f1, grid: gr1}
    - {dataset: GISS-E2-1-G, ensemble: r1i1p1f2, grid: gn}
#    - {dataset: GISS-E2-1-G, ensemble: r1i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-G, ensemble: r2i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-G, ensemble: r3i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-G, ensemble: r4i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-G, ensemble: r5i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-G, ensemble: r6i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-G, ensemble: r7i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-G, ensemble: r8i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-G, ensemble: r9i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-G, ensemble: r10i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-G-CC, ensemble: r1i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-H, ensemble: r1i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-H, ensemble: r2i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-H, ensemble: r3i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-H, ensemble: r4i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-H, ensemble: r5i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-H, ensemble: r6i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-H, ensemble: r7i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-H, ensemble: r8i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-H, ensemble: r9i1p1f1, grid: gn}
#    - {dataset: GISS-E2-1-H, ensemble: r10i1p1f1, grid: gn}
    - {dataset: HadGEM3-GC31-LL, ensemble: r1i1p1f3, grid: gn}
#    - {dataset: HadGEM3-GC31-LL, ensemble: r2i1p1f3, grid: gn}
#    - {dataset: HadGEM3-GC31-LL, ensemble: r3i1p1f3, grid: gn}
#    - {dataset: HadGEM3-GC31-LL, ensemble: r4i1p1f3, grid: gn}
    - {dataset: IPSL-CM6A-LR, ensemble: r1i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r2i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r3i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r4i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r5i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r6i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r7i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r8i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r9i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r10i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r11i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r12i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r13i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r14i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r15i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r16i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r17i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r18i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r19i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r20i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r21i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r22i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r23i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r24i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r25i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r26i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r27i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r28i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r29i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r30i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r31i1p1f1, grid: gr}
#    - {dataset: IPSL-CM6A-LR, ensemble: r32i1p1f1, grid: gr}
#    - {dataset: MCM-UA-1-0, ensemble: r1i1p1f2, grid: gn}
#    - {dataset: MCM-UA-1-0, ensemble: r1i1p1f1, grid: gn}
    - {dataset: MIROC-ES2L, ensemble: r1i1p1f2, grid: gn}
    - {dataset: MIROC6, ensemble: r1i1p1f1, grid: gn}
#    - {dataset: MIROC6, ensemble: r2i1p1f1, grid: gn}
#    - {dataset: MIROC6, ensemble: r3i1p1f1, grid: gn}
#    - {dataset: MIROC6, ensemble: r4i1p1f1, grid: gn}
#    - {dataset: MIROC6, ensemble: r5i1p1f1, grid: gn}
#    - {dataset: MIROC6, ensemble: r6i1p1f1, grid: gn}
#    - {dataset: MIROC6, ensemble: r7i1p1f1, grid: gn}
#    - {dataset: MIROC6, ensemble: r8i1p1f1, grid: gn}
#    - {dataset: MIROC6, ensemble: r9i1p1f1, grid: gn}
#    - {dataset: MIROC6, ensemble: r10i1p1f1, grid: gn}
#    - {dataset: MPI-ESM1-2-HR, ensemble: r1i1p1f1, grid: gn}
    - {dataset: MRI-ESM2-0, ensemble: r1i1p1f1, grid: gn}
#    - {dataset: MRI-ESM2-0, ensemble: r2i1p1f1, grid: gn}
#    - {dataset: MRI-ESM2-0, ensemble: r3i1p1f1, grid: gn}
#    - {dataset: MRI-ESM2-0, ensemble: r4i1p1f1, grid: gn}
#    - {dataset: MRI-ESM2-0, ensemble: r5i1p1f1, grid: gn}
    - {dataset: NESM3, ensemble: r1i1p1f1, grid: gn}
    - {dataset: NorCPM1, ensemble: r1i1p1f1, grid: gn}
#    - {dataset: NorCPM1, ensemble: r26i1p1f1, grid: gn}
    - {dataset: NorESM2-LM, ensemble: r1i1p1f1, grid: gn, start_year: 1950}
    - {dataset: SAM0-UNICON, ensemble: r1i1p1f1, grid: gn}
    - {dataset: UKESM1-0-LL, ensemble: r1i1p1f2, grid: gn}
#    - {dataset: UKESM1-0-LL, ensemble: r2i1p1f2, grid: gn}
#    - {dataset: UKESM1-0-LL, ensemble: r3i1p1f2, grid: gn}
#    - {dataset: UKESM1-0-LL, ensemble: r4i1p1f2, grid: gn}
#    - {dataset: UKESM1-0-LL, ensemble: r5i1p1f2, grid: gn}
#    - {dataset: UKESM1-0-LL, ensemble: r6i1p1f2, grid: gn}
#    - {dataset: UKESM1-0-LL, ensemble: r7i1p1f2, grid: gn}
#    - {dataset: UKESM1-0-LL, ensemble: r8i1p1f2, grid: gn}
#    - {dataset: UKESM1-0-LL, ensemble: r9i1p1f2, grid: gn}

preprocessors:

  pp:
    regrid:
      target_grid: 2.5x2.5
      scheme: linear
    multi_model_statistics:
      span: overlap
      statistics: [mean]
      exclude: [reference_dataset, alternative_dataset]

  pp_land:
    regrid:
      target_grid: 0.5x0.5
      scheme: linear
    mask_landsea:
      mask_out: sea
    multi_model_statistics:
      span: overlap
      statistics: [mean]
      exclude: [GPCC-SG, CMAP, GPCC, CRU-TS]
      
  ppsfc:
    regrid:
      target_grid: 2.5x2.5
      scheme: linear
    multi_model_statistics:
      span: overlap
      statistics: [mean]
      exclude: [reference_dataset]

  pp850+200:
    extract_levels:
      levels: [85000, 20000]
      scheme: linear
    regrid:
      target_grid: 2.5x2.5
      scheme: linear
    multi_model_statistics:
      span: overlap
      statistics: [mean]
      exclude: [reference_dataset]

diagnostics:

  global_monsoon_cmip6:
    description: define monsoon domain and calculate intensity index
    variables:
      pr:
        preprocessor: pp
        reference_dataset: GPCP-SG
        alternative_dataset: CMAP
        mip: Amon
        frequency: mon
        field: T2Ms
        project: CMIP6
        exp: historical
#        exp: [historical, ssp245]
        start_year: 1850
        end_year: 2014
        additional_datasets:
          - {dataset: GPCP-SG, project: obs4mips, level: L3, version: v2.3, 
             start_year: 1979, end_year: 2017, tier: 2}
          - {dataset: CMAP, project: OBS, type: satellite, version: V1902, 
             start_year: 1979, end_year: 2018, tier: 2}

 #     uas:
 #       preprocessor: ppsfc
      ua:
        preprocessor: pp850+200
        reference_dataset: ERA5
        mip: Amon
        frequency: mon
        field: T2Ms
        project: CMIP6
        exp: historical
#        exp: [historical, ssp245]
        start_year: 1850
        end_year: 2014
        additional_datasets:
          - {dataset: ERA5, project: OBS, type: reanaly, version: 1, tier: 3,
             start_year: 1979, end_year: 2018}
          - {dataset: JRA-55, project: ana4mips, type: reanalysis, version: 1, tier: 3,
             start_year: 1958, end_year: 2013}
#          - {dataset: CFSR, project: ana4mips, type: reanalysis, version: 1, tier: 3,
#             start_year: 1979, end_year: 2013}
          - {dataset: MERRA2, project: ana4mips, type: reanalysis, version: 1, tier: 3,
             start_year: 1980, end_year: 2014}
#      vas:
#        preprocessor: ppsfc
      va:
        preprocessor: pp850+200
        reference_dataset: ERA5
        mip: Amon
        frequency: mon
        field: T2Ms
        project: CMIP6
        exp: historical
#        exp: [historical, ssp245]
        start_year: 1850
        end_year: 2014
        additional_datasets:
          - {dataset: ERA5, project: OBS, type: reanaly, version: 1, tier: 3,
             start_year: 1979, end_year: 2018}
#          - {dataset: JRA-55, project: ana4mips, type: reanalysis, version: 1, tier: 3,
#             start_year: 1958, end_year: 2013}
#          - {dataset: CFSR, project: ana4mips, type: reanalysis, version: 1, tier: 3,
#             start_year: 1979, end_year: 2013}
#          - {dataset: MERRA2, project: ana4mips, type: reanalysis, version: 1, tier: 3,
#             start_year: 1980, end_year: 2016}

    scripts:
      monsoon_domain_intensity: 
        script: ar6ch3_monsoon/monsoon_domain_intensity.ncl
        syear_clim: 1979
        eyear_clim: 2014
        smonth_NHsummer: 5
        emonth_NHsummer: 9
        smonth_SHsummer: 11
        emonth_SHsummer: 3
#        threshold_summer_minus_witner: 300.
#        threshold_mpi: 0.5
        
  draw_global_monsoon_cmip6:
    description: Wrapper to collect and plot figures
    scripts:
      plot_global_monsoon:
        script: ar6ch3_monsoon/draw_global_monsoon.ncl
        moving_ave: 0
        scale_precip_ann: True
        dataset_obs_pr: GPCP-SG
        dataset_obs_uv: ERA5
        ancestors: ['global_monsoon_cmip6/monsoon_domain_intensity']
      plot_global_monsoon_runmean11yr:
        script: ar6ch3_monsoon/draw_global_monsoon.ncl
        moving_ave: 11
        scale_precip_ann: True
        dataset_obs_pr: GPCP-SG
        dataset_obs_uv: ERA5
        ancestors: ['global_monsoon_cmip6/monsoon_domain_intensity']
      plot_global_monsoon_runmean15yr:
        script: ar6ch3_monsoon/draw_global_monsoon.ncl
        moving_ave: 15
        scale_precip_ann: True
        dataset_obs_pr: GPCP-SG
        dataset_obs_uv: ERA5
        ancestors: ['global_monsoon_cmip6/monsoon_domain_intensity']
      plot_global_monsoon_runmean20yr:
        script: ar6ch3_monsoon/draw_global_monsoon.ncl
        moving_ave: 20
        scale_precip_ann: True
        dataset_obs_pr: GPCP-SG
        dataset_obs_uv: ERA5
        ancestors: ['global_monsoon_cmip6/monsoon_domain_intensity']

        
  global_landmonsoon_cmip6:
    description: define monsoon domain and calculate intensity index
    variables:
      pr:
        preprocessor: pp_land
        mip: Amon
        frequency: mon
        field: T2Ms
        project: CMIP6
        exp: historical
#        exp: [historical, ssp245]
        start_year: 1850
        end_year: 2014
        additional_datasets:
          - {dataset: GPCP-SG, project: obs4mips, level: L3, version: v2.3, 
             start_year: 1979, end_year: 2017, tier: 2}
          - {dataset: CMAP, project: OBS, type: satellite, version: V1902, 
             start_year: 1979, end_year: 2018, tier: 2}
          - {dataset: GPCC, project: OBS, type: insitu, version: v2018, 
             start_year: 1891, end_year: 2016, tier: 2}
          - {dataset: CRU-TS, project: OBS, type: insitu, version: 4.02, 
             start_year: 1901, end_year: 2016, tier: 3}

    scripts:
      monsoon_domain_intensity: 
        script: ar6ch3_monsoon/monsoon_domain_intensity.ncl
        syear_clim: 1979
        eyear_clim: 2014
        smonth_NHsummer: 5
        emonth_NHsummer: 9
        smonth_SHsummer: 11
        emonth_SHsummer: 3
#        threshold_summer_minus_witner: 300.
#        threshold_mpi: 0.5
        
  draw_global_landmonsoon_cmip6:
    description: Wrapper to collect and plot figures
    scripts:
      plot_global_monsoon:
        script: ar6ch3_monsoon/draw_global_monsoon.ncl
        moving_ave: 0
        scale_precip_ann: True
        dataset_obs_pr: GPCC
        ancestors: ['global_landmonsoon_cmip6/monsoon_domain_intensity']
      plot_global_monsoon_runmean11yr:
        script: ar6ch3_monsoon/draw_global_monsoon.ncl
        moving_ave: 11
        scale_precip_ann: True
        dataset_obs_pr: GPCC
        ancestors: ['global_landmonsoon_cmip6/monsoon_domain_intensity']
      plot_global_monsoon_runmean15yr:
        script: ar6ch3_monsoon/draw_global_monsoon.ncl
        moving_ave: 15
        scale_precip_ann: True
        dataset_obs_pr: GPCC
        ancestors: ['global_landmonsoon_cmip6/monsoon_domain_intensity']
      plot_global_monsoon_runmean20yr:
        script: ar6ch3_monsoon/draw_global_monsoon.ncl
        moving_ave: 20
        scale_precip_ann: True
        dataset_obs_pr: GPCC
        ancestors: ['global_landmonsoon_cmip6/monsoon_domain_intensity']
