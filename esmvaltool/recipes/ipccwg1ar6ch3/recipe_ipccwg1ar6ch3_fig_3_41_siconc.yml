# ESMValTool
# recipe_seaice.yml
---
documentation:
  description: |
    Recipe for Arctic and Antarctic sea ice diagnostics.

  authors:
    - senftleben_daniel

  maintainer:
    - lauer_axel

  references:
    - massonnet12tc
    - stroeve07grl

  projects:
    - crescendo
    - esmval



diagnostics:
  seaice_tsline_hist:
    description: Timeseries of September Arctic/Antartic sea ice area and extent
    themes:
      - seaIce
    realms:
      - seaIce
    variables:
      siconc: &var_def
        mip: SImon
        project: CMIP6
        exp: historical
        reference_dataset: HadISST
        ensemble: r1i1p1f1
        start_year: 1950
        end_year: 2017
        additional_datasets: &siconc_datasets
          - {dataset: ACCESS-CM2, ensemble: r1i1p1f1, grid: gn}
          - {dataset: ACCESS-ESM1-5, ensemble: r1i1p1f1, grid: gn}
          #- {dataset: BCC-ESM1, ensemble: r2i1p1f1, grid: gn} #no areacello
          #- {dataset: BCC-CSM2-MR, grid: gn} #no areacello
          #- {dataset: CAMS-CSM1-0, ensemble: r2i1p1f1, grid: gn} #no areacello
          #- {dataset: CanESM5, grid: gn} #in sie_sh, areacello not conformal
          - {dataset: CanESM5-CanOE, ensemble: r1i1p2f1, grid: gn}
          #- {dataset: CESM2, grid: gn} #in sie_sh, areacello not conformal
          - {dataset: CESM2-FV2, ensemble: r1i1p1f1, grid: gn}
          #- {dataset: CESM2-WACCM, ensemble: r2i1p1f1, grid: gn} #no areacello
          - {dataset: CESM2-WACCM-FV2, ensemble: r1i1p1f1, grid: gn}
          #- {dataset: CIESM, ensemble: r2i1p1f1, grid: gn} #preprocessor fails
          #- {dataset: CMCC-CM2-HR4, grid: gn} #in sie_sh, areacello not conformal
          #- {dataset: CMCC-CM2-SR5, grid: gn} #in sie_sh, areacello not conformal
          #- {dataset: CMCC-ESM2, grid: gn} #no areacello
          - {dataset: CNRM-CM6-1, ensemble: r1i1p1f2, grid: gn}
          - {dataset: CNRM-CM6-1-HR, grid: gn, ensemble: r1i1p1f2}
          - {dataset: CNRM-ESM2-1, ensemble: r1i1p1f2, grid: gn}
          #- {dataset: E3SM-1-0, ensemble: r2i1p1f1, grid: gr} #no areacello
          #- {dataset: EC-Earth3, grid: gn} #concatinate error
          #- {dataset: EC-Earth3-AerChem, grid: gn} #no areacello
          #- {dataset: EC-Earth3-CC, grid: gn} ##no areacello
          - {dataset: EC-Earth3-Veg, ensemble: r4i1p1f1, grid: gn} #concatinate error
          #- {dataset: EC-Earth3-Veg-LR, ensemble: r1i1p1f1, grid: gn} #no areacello
          #- {dataset: FGOALS-f3-L, ensemble: r1i1p1f1, grid: gn} #preprocessor fails
          #- {dataset: FGOALS-g3, grid: gn} #strange areacello
          - {dataset: FIO-ESM-2-0, ensemble: r1i1p1f1, grid: gn}
          #- {dataset: GFDL-CM4, grid: gn} # preprocessor fails
          - {dataset: GFDL-ESM4, ensemble: r1i1p1f1, grid: gn} #no areacello
          #- {dataset: GISS-E2-1-H, ensemble: r1i1p1f2, grid: gr} #no areacello
          #- {dataset: HadGEM3-GC31-LL, ensemble: r3i1p1f3, grid: gn} #no areacello
          #- {dataset: HadGEM3-GC31-MM, ensemble: r2i1p1f3, grid: gn} #no areacello
          #- {dataset: INM-CM4-8, grid: gr1} # no areacello 
          #- {dataset: INM-CM5-0, ensemble: r2i1p1f1, grid: gr1} #no areacello
          #- {dataset: IPSL-CM5A2-INCA, grid: gn} #rejected
          #- {dataset: IPSL-CM6A-LR, ensemble: r13i1p1f1, grid: gn} #error areacello
          #- {dataset: KIOST-ESM, grid: gn}
          - {dataset: MIROC6, ensemble: r1i1p1f1, grid: gn}
          - {dataset: MIROC-ES2L, ensemble: r1i1p1f2, grid: gn}
          - {dataset: MPI-ESM-1-2-HAM, ensemble: r1i1p1f1, grid: gn}
          - {dataset: MPI-ESM1-2-HR, ensemble: r1i1p1f1, grid: gn}
          - {dataset: MPI-ESM1-2-LR, ensemble: r1i1p1f1, grid: gn}
          - {dataset: MRI-ESM2-0, ensemble: r1i1p1f1, grid: gn} 
          #- {dataset: NESM3, ensemble: r2i1p1f1, grid: gn} #no areacello
          - {dataset: NorCPM1, ensemble: r10i1p1f1, grid: gn}
          #- {dataset: NorESM2-LM, ensemble: r2i1p1f1, grid: gn} #in sie_sh, areacello not conformal
          #- {dataset: NorESM2-MM, ensemble: r2i1p1f1, grid: gn} #in sie_sh, areacello not conformal
          #- {dataset: NorESM2-MM, grid: gn} #Failed to run concatenate
          #- {dataset: SAM0-UNICON, ensemble: r1i1p1f1, grid: gn} #preprocessor fails
          #- {dataset: TaiESM1, grid: gn} #no areacello
          #- {dataset: UKESM1-0-LL, ensemble: r2i1p1f2, grid: gn} #no areacello
          - {dataset: HadISST, project: OBS6, type: reanaly, version: 1, tier: 2}
      areacello:
        mip: Ofx
        project: CMIP6
        exp: historical
        ensemble: r1i1p1f1
        additional_datasets:
          #<<: *siconc_datasets
          - {dataset: ACCESS-CM2, ensemble: r1i1p1f1, grid: gn}
          - {dataset: ACCESS-ESM1-5, ensemble: r1i1p1f1, grid: gn}
          #- {dataset: BCC-ESM1, ensemble: r2i1p1f1, grid: gn} #no areacello
          #- {dataset: BCC-CSM2-MR, grid: gn} #no areacello
          #- {dataset: CAMS-CSM1-0, ensemble: r2i1p1f1, grid: gn} #no areacello
          #- {dataset: CanESM5, grid: gn} #in sie_sh, areacello not conformal
          - {dataset: CanESM5-CanOE, ensemble: r1i1p2f1, grid: gn}
          #- {dataset: CESM2, grid: gn} #in sie_sh, areacello not conformal
          - {dataset: CESM2-FV2, ensemble: r1i1p1f1, grid: gn}
          #- {dataset: CESM2-WACCM, ensemble: r2i1p1f1, grid: gn} #no areacello
          - {dataset: CESM2-WACCM-FV2, ensemble: r1i1p1f1, grid: gn}
          #- {dataset: CIESM, ensemble: r2i1p1f1, grid: gn} #preprocessor fails
          #- {dataset: CMCC-CM2-HR4, grid: gn} #in sie_sh, areacello not conformal
          #- {dataset: CMCC-CM2-SR5, grid: gn} #in sie_sh, areacello not conformal
          #- {dataset: CMCC-ESM2, grid: gn} #no areacello
          - {dataset: CNRM-CM6-1, ensemble: r1i1p1f2, grid: gn}
          - {dataset: CNRM-CM6-1-HR, grid: gn, ensemble: r1i1p1f2}
          - {dataset: CNRM-ESM2-1, ensemble: r1i1p1f2, grid: gn}
          #- {dataset: E3SM-1-0, ensemble: r2i1p1f1, grid: gr} #no areacello
          #- {dataset: EC-Earth3, grid: gn} #concatinate error
          #- {dataset: EC-Earth3-AerChem, grid: gn} #no areacello
          #- {dataset: EC-Earth3-CC, grid: gn} ##no areacello
          - {dataset: EC-Earth3-Veg, ensemble: r4i1p1f1, grid: gn} #concatinate error
          #- {dataset: EC-Earth3-Veg-LR, ensemble: r1i1p1f1, grid: gn} #no areacello
          #- {dataset: FGOALS-f3-L, ensemble: r1i1p1f1, grid: gn} #preprocessor fails
          #- {dataset: FGOALS-g3, grid: gn} #strange areacello
          - {dataset: FIO-ESM-2-0, ensemble: r1i1p1f1, grid: gn}
          #- {dataset: GFDL-CM4, grid: gn} # preprocessor fails
          - {dataset: GFDL-ESM4, ensemble: r1i1p1f1, grid: gn} #no areacello
          #- {dataset: GISS-E2-1-H, ensemble: r1i1p1f2, grid: gr} #no areacello
          #- {dataset: HadGEM3-GC31-LL, ensemble: r3i1p1f3, grid: gn} #no areacello
          #- {dataset: HadGEM3-GC31-MM, ensemble: r2i1p1f3, grid: gn} #no areacello
          #- {dataset: INM-CM4-8, grid: gr1} # no areacello 
          #- {dataset: INM-CM5-0, ensemble: r2i1p1f1, grid: gr1} #no areacello
          #- {dataset: IPSL-CM5A2-INCA, grid: gn} #rejected
          #- {dataset: IPSL-CM6A-LR, ensemble: r13i1p1f1, grid: gn} #error areacello
          #- {dataset: KIOST-ESM, grid: gn}
          - {dataset: MIROC6, ensemble: r1i1p1f1, grid: gn}
          - {dataset: MIROC-ES2L, ensemble: r1i1p1f2, grid: gn}
          - {dataset: MPI-ESM-1-2-HAM, ensemble: r1i1p1f1, grid: gn}
          - {dataset: MPI-ESM1-2-HR, ensemble: r1i1p1f1, grid: gn}
          - {dataset: MPI-ESM1-2-LR, ensemble: r1i1p1f1, grid: gn}
          - {dataset: MRI-ESM2-0, ensemble: r1i1p1f1, grid: gn} 
          #- {dataset: NESM3, ensemble: r2i1p1f1, grid: gn} #no areacello
          - {dataset: NorCPM1, ensemble: r10i1p1f1, grid: gn}
          #- {dataset: NorESM2-LM, ensemble: r2i1p1f1, grid: gn} #in sie_sh, areacello not conformal
          #- {dataset: NorESM2-MM, ensemble: r2i1p1f1, grid: gn} #in sie_sh, areacello not conformal
          #- {dataset: NorESM2-MM, grid: gn} #Failed to run concatenate
          #- {dataset: SAM0-UNICON, ensemble: r1i1p1f1, grid: gn} #preprocessor fails
          #- {dataset: TaiESM1, grid: gn} #no areacello
          #- {dataset: UKESM1-0-LL, ensemble: r2i1p1f2, grid: gn} #no areacello
    scripts: &sic_diag
      sie_nh: &sic_nh_settings
        script: seaice/seaice_tsline.ncl
        # "Arctic" or "Antarctic"; entire hemisphere will be evaluated
        region: "Arctic"
        # A = annual mean, 3 = March, 9 = September
        month: "9"
        # "CMIP5", "DEFAULT"
        styleset: "CMIP6"
        # Plot multi-model mean & std dev
        multi_model_mean: true
        # Create legend label for each individual ensemble member
        EMs_in_lg: false
        # Fill polar hole in data with sic = 1.
        fill_pole_hole: true
        # save statistics
        write_stat: True
        stat: "MinMax"
        # calculate anomaly
        anom: True
        #yr_mean: 5
      sie_sh: &sic_sh_settings
        <<: *sic_nh_settings
        # "Arctic" or "Antarctic"; entire hemisphere will be evaluated
        region: "Antarctic"
        # Create legend label for each individual ensemble member
        EMs_in_lg: false
        # Fill polar hole in data with sic = 1.
        fill_pole_hole: false

  seaice_tsline_hist-nat:
    description: Timeseries of September Arctic/Antartic sea ice area and extent
    themes:
      - seaIce
    realms:
      - seaIce
    variables:
      siconc: 
        <<: *var_def
        exp: hist-nat
        additional_datasets: &siconc_datasets_nat
          - {dataset: ACCESS-ESM1-5, ensemble: r1i1p1f1, grid: gn}
          - {dataset: CanESM5, ensemble: r1i1p1f1, grid: gn}
          - {dataset: CESM2, ensemble: r1i1p1f1, grid: gn}
          - {dataset: CNRM-CM6-1, ensemble: r1i1p1f2, grid: gn}
          #- {dataset: IPSL-CM6A-LR, ensemble: r1i1p1f1, grid: gn}
          - {dataset: MIROC6, ensemble: r1i1p1f1, grid: gn}
          - {dataset: MRI-ESM2-0, ensemble: r3i1p1f1, grid: gn}
          #- {dataset: NorESM2-LM, grid: gn} #in sie_sh, areacello not conformal
          - {dataset: HadISST, project: OBS6, type: reanaly, version: 1, tier: 2}
      areacello:
        mip: Ofx
        project: CMIP6
        exp: hist-nat
        ensemble: r1i1p1f1
        additional_datasets:
          - {dataset: ACCESS-ESM1-5, ensemble: r1i1p1f1, grid: gn}
          - {dataset: CanESM5, ensemble: r1i1p1f1, grid: gn}
          - {dataset: CESM2, ensemble: r1i1p1f1, grid: gn}
          - {dataset: CNRM-CM6-1, ensemble: r1i1p1f2, grid: gn}
          #- {dataset: IPSL-CM6A-LR, ensemble: r1i1p1f1, grid: gn}
          - {dataset: MIROC6, ensemble: r1i1p1f1, grid: gn}
          - {dataset: MRI-ESM2-0, ensemble: r3i1p1f1, grid: gn}
          #- {dataset: NorESM2-LM, grid: gn} #in sie_sh, areacello not conformal
    scripts:
      <<: *sic_diag

  fig_3_40_sie:
    description: IPCC AR5 Ch. 10, Fig. 10.21
    variables:
      siconc:
        start_year: 1950
        end_year: 2014
        mip: SImon
        reference_dataset: HadISST
    additional_datasets:
      - {dataset: HadISST, project: OBS6, type: reanaly, version: 1, tier: 2}
    scripts:
      collect_nh:
        <<: *sic_nh_settings
        script: ipcc_ar6/tsline_collect.ncl
        ancestors: [siconc, 'seaice_tsline_*/sie_nh']
        ref: ["HadISST"]
        order: ["CMIP6_historical", "CMIP6_hist-nat"]
        time_avg: "yearly"
        stat_shading: True
        start_year: 1950
        end_year: 2017
        ts_anomaly: "anom"
        ref_start: 1979
        ref_end: 1999
        y_min: -4.5
        y_max: 4.5
      collect_sh:
        <<: *sic_sh_settings
        script: ipcc_ar6/tsline_collect.ncl
        ancestors: [siconc, 'seaice_tsline_*/sie_sh']
        ref: ["HadISST"]
        order: ["CMIP6_historical", "CMIP6_hist-nat"]
        time_avg: "yearly"
        stat_shading: True
        start_year: 1950
        end_year: 2017
        ts_anomaly: "anom"
        ref_start: 1979
        ref_end: 1999
        y_min: -4.5
        y_max: 4.5

      
