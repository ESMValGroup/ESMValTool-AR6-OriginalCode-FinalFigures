# ESMValTool
# recipe_ar6ch3_hadleycell.yml
---
documentation:

  description: |
    Producing selected figures from IPCC WGI AR6, chap. 3

  authors:
    - kosaka_yu

#  maintainer:
    
  references:
   - acknow_project

  projects:
    - ipcc_ar6

  realms:
    - atmos

  themes:
    - atmDyn

  domains:
    - trop
    - midlat

  plot_types:
    - bar

  statistics:
    - trend

datasets:
#    - {dataset: AWI-CM2-1-MR, ensemble: r1i1p1f1, grid: gn}
#    - {dataset: AWI-CM-1-1-MR, ensemble: r2i1p1f1, grid: gn}
#    - {dataset: AWI-CM-1-1-MR, ensemble: r3i1p1f1, grid: gn}
    - {dataset: BCC-CSM2-MR, ensemble: r1i1p1f1, grid: gn}
    - {dataset: BCC-CSM2-MR, ensemble: r2i1p1f1, grid: gn}
    - {dataset: BCC-CSM2-MR, ensemble: r3i1p1f1, grid: gn}
    - {dataset: BCC-ESM1, ensemble: r1i1p1f1, grid: gn}
    - {dataset: BCC-ESM1, ensemble: r2i1p1f1, grid: gn}
    - {dataset: BCC-ESM1, ensemble: r3i1p1f1, grid: gn}
    - {dataset: CAMS-CSM1-0, ensemble: r1i1p1f1, grid: gn}
#    - {dataset: CESM2-WACCM, ensemble: r1i1p1f1, grid: gn}
#    - {dataset: CESM2-WACCM, ensemble: r2i1p1f1, grid: gn}
#    - {dataset: CESM2-WACCM, ensemble: r3i1p1f1, grid: gn}
#    - {dataset: CESM2, ensemble: r1i1p1f1, grid: gn}
#    - {dataset: CESM2, ensemble: r2i1p1f1, grid: gn}
#    - {dataset: CESM2, ensemble: r3i1p1f1, grid: gn}
#    - {dataset: CESM2, ensemble: r4i1p1f1, grid: gn}
#    - {dataset: CESM2, ensemble: r5i1p1f1, grid: gn}
#    - {dataset: CESM2, ensemble: r6i1p1f1, grid: gn}
    - {dataset: CNRM-CM6-1, ensemble: r1i1p1f2, grid: gr}
    - {dataset: CNRM-CM6-1, ensemble: r2i1p1f2, grid: gr}
    - {dataset: CNRM-CM6-1, ensemble: r3i1p1f2, grid: gr}
    - {dataset: CNRM-CM6-1, ensemble: r4i1p1f2, grid: gr}
    - {dataset: CNRM-CM6-1, ensemble: r5i1p1f2, grid: gr}
    - {dataset: CNRM-CM6-1, ensemble: r6i1p1f2, grid: gr}
    - {dataset: CNRM-CM6-1, ensemble: r7i1p1f2, grid: gr}
    - {dataset: CNRM-CM6-1, ensemble: r8i1p1f2, grid: gr}
    - {dataset: CNRM-CM6-1, ensemble: r9i1p1f2, grid: gr}
    - {dataset: CNRM-CM6-1, ensemble: r10i1p1f2, grid: gr}
    - {dataset: CNRM-ESM2-1, ensemble: r1i1p1f2, grid: gr}
    - {dataset: CNRM-ESM2-1, ensemble: r2i1p1f2, grid: gr}
    - {dataset: CNRM-ESM2-1, ensemble: r3i1p1f2, grid: gr}
    - {dataset: CNRM-ESM2-1, ensemble: r4i1p1f2, grid: gr}
    - {dataset: CNRM-ESM2-1, ensemble: r5i1p1f2, grid: gr}
    - {dataset: CanESM5, ensemble: r1i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r2i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r3i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r4i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r5i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r6i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r7i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r8i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r9i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r10i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r11i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r12i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r13i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r14i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r15i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r16i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r17i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r18i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r19i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r20i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r21i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r22i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r23i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r24i1p1f1, grid: gn}
    - {dataset: CanESM5, ensemble: r25i1p1f1, grid: gn}
#    - {dataset: E3SM-1-0, ensemble: r1i1p1f1, grid: gr}
#    - {dataset: E3SM-1-0, ensemble: r2i1p1f1, grid: gr}
#    - {dataset: E3SM-1-0, ensemble: r3i1p1f1, grid: gr}
    - {dataset: EC-Earth3, ensemble: r1i1p1f1, grid: gr}
#    - {dataset: EC-Earth3, ensemble: r2i1p1f1, grid: gr} #missing 2008-2013
    - {dataset: EC-Earth3, ensemble: r6i1p1f1, grid: gr}
    - {dataset: EC-Earth3, ensemble: r9i1p1f1, grid: gr}
    - {dataset: EC-Earth3, ensemble: r11i1p1f1, grid: gr}
    - {dataset: EC-Earth3, ensemble: r13i1p1f1, grid: gr}
    - {dataset: EC-Earth3, ensemble: r15i1p1f1, grid: gr}
    - {dataset: EC-Earth3, ensemble: r21i1p1f1, grid: gr}
    - {dataset: EC-Earth3, ensemble: r22i1p1f1, grid: gr}
    - {dataset: EC-Earth3, ensemble: r24i1p1f1, grid: gr}
    - {dataset: EC-Earth3-Veg, ensemble: r1i1p1f1, grid: gr}
#    - {dataset: FGOALS-g3, ensemble: r1i1p1f1, grid: gn}
    - {dataset: GFDL-CM4, ensemble: r1i1p1f1, grid: gr1}
    - {dataset: GFDL-ESM4, ensemble: r1i1p1f1, grid: gr1}
    - {dataset: GISS-E2-1-G, ensemble: r1i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-G, ensemble: r2i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-G, ensemble: r3i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-G, ensemble: r4i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-G, ensemble: r5i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-G, ensemble: r6i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-G, ensemble: r7i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-G, ensemble: r8i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-G, ensemble: r9i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-G, ensemble: r10i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-G-CC, ensemble: r1i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-H, ensemble: r1i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-H, ensemble: r2i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-H, ensemble: r3i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-H, ensemble: r4i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-H, ensemble: r5i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-H, ensemble: r6i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-H, ensemble: r7i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-H, ensemble: r8i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-H, ensemble: r9i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-H, ensemble: r10i1p1f1, grid: gn}
    - {dataset: HadGEM3-GC31-LL, ensemble: r1i1p1f3, grid: gn}
    - {dataset: HadGEM3-GC31-LL, ensemble: r2i1p1f3, grid: gn}
    - {dataset: HadGEM3-GC31-LL, ensemble: r3i1p1f3, grid: gn}
    - {dataset: HadGEM3-GC31-LL, ensemble: r4i1p1f3, grid: gn}
    - {dataset: IPSL-CM6A-LR, ensemble: r1i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r2i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r3i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r4i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r5i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r6i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r7i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r8i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r9i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r10i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r11i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r12i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r13i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r14i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r15i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r16i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r17i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r18i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r19i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r20i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r21i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r22i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r23i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r24i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r25i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r26i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r27i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r28i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r29i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r30i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r31i1p1f1, grid: gr}
    - {dataset: IPSL-CM6A-LR, ensemble: r32i1p1f1, grid: gr}
#    - {dataset: MCM-UA-1-0, ensemble: r1i1p1f1, grid: gn} #preprocessor failure
    - {dataset: MIROC-ES2L, ensemble: r1i1p1f2, grid: gn}
    - {dataset: MIROC6, ensemble: r1i1p1f1, grid: gn}
    - {dataset: MIROC6, ensemble: r2i1p1f1, grid: gn}
    - {dataset: MIROC6, ensemble: r3i1p1f1, grid: gn}
    - {dataset: MIROC6, ensemble: r4i1p1f1, grid: gn}
    - {dataset: MIROC6, ensemble: r5i1p1f1, grid: gn}
    - {dataset: MIROC6, ensemble: r6i1p1f1, grid: gn}
    - {dataset: MIROC6, ensemble: r7i1p1f1, grid: gn}
    - {dataset: MIROC6, ensemble: r8i1p1f1, grid: gn}
    - {dataset: MIROC6, ensemble: r9i1p1f1, grid: gn}
    - {dataset: MIROC6, ensemble: r10i1p1f1, grid: gn}
    - {dataset: MRI-ESM2-0, ensemble: r1i1p1f1, grid: gn}
    - {dataset: MRI-ESM2-0, ensemble: r2i1p1f1, grid: gn}
    - {dataset: MRI-ESM2-0, ensemble: r3i1p1f1, grid: gn}
    - {dataset: MRI-ESM2-0, ensemble: r4i1p1f1, grid: gn}
    - {dataset: MRI-ESM2-0, ensemble: r5i1p1f1, grid: gn}
    - {dataset: NESM3, ensemble: r1i1p1f1, grid: gn}
    - {dataset: NorCPM1, ensemble: r1i1p1f1, grid: gn}
#    - {dataset: NorESM2-LM, ensemble: r1i1p1f1, grid: gn} #preprocessor failure
#    - {dataset: SAM0-UNICON, ensemble: r1i1p1f1, grid: gn}
#    - {dataset: UKESM1-0-LL, ensemble: r1i1p1f2, grid: gn} # metadata fix failure
#    - {dataset: UKESM1-0-LL, ensemble: r2i1p1f2, grid: gn} # metadata fix failure
#    - {dataset: UKESM1-0-LL, ensemble: r3i1p1f2, grid: gn} # metadata fix failure
#    - {dataset: UKESM1-0-LL, ensemble: r4i1p1f2, grid: gn} # metadata fix failure
#    - {dataset: UKESM1-0-LL, ensemble: r5i1p1f2, grid: gn} # metadata fix failure
#    - {dataset: UKESM1-0-LL, ensemble: r6i1p1f2, grid: gn} # metadata fix failure
#    - {dataset: UKESM1-0-LL, ensemble: r7i1p1f2, grid: gn} # metadata fix failure
#    - {dataset: UKESM1-0-LL, ensemble: r8i1p1f2, grid: gn} # metadata fix failure
#    - {dataset: UKESM1-0-LL, ensemble: r9i1p1f2, grid: gn} # metadata fix failure
        
preprocessors:

  pp_DJF_zonalmean:
    extract_season:
      season: DJF
    seasonal_statistics:
      operator: mean
    zonal_means: &zonalmean
      coordinate: longitude
      mean_type: mean

  pp_MAM_zonalmean:
    extract_season:
      season: MAM
    seasonal_statistics:
      operator: mean
    zonal_means:
      <<: *zonalmean
    
  pp_JJA_zonalmean:
    extract_season:
      season: JJA
    seasonal_statistics:
      operator: mean
    zonal_means:
      <<: *zonalmean

  pp_SON_zonalmean:
    extract_season:
      season: SON
    seasonal_statistics:
      operator: mean
    zonal_means:
      <<: *zonalmean

  pp_ANN_zonalmean:
    annual_statistics:
      operator: mean
    zonal_means:
      <<: *zonalmean
      
diagnostics:

  NH_edge_trend_ANN:
    description: calculate pdf of trends in annual mean NH Hadley cell edges
    variables: 
      uas: &variable
        preprocessor: pp_ANN_zonalmean
#        obs_dataset: ['ERA-Interim', 'JRA-55']
        mip: Amon
        frequency: mon
        field: T3Ms
        project: CMIP6
        exp: historical
        start_year: 1980
        end_year: 2013
        additional_datasets:
          - {dataset: ERA-Interim, project: ana4mips, type: reanalysis, version: 1, 
             tier: 3}
          - {dataset: JRA-55, project: ana4mips, type: reanalysis, version: 1,
             tier: 3}
          - {dataset: CFSR, project: ana4mips, type: reanalysis, version: 1,
             tier: 3}
          - {dataset: MERRA2, project: ana4mips, type: reanalysis, version: 1,
             tier: 3}
    scripts:
      trend: &trend_setting
        script: ar6ch3_hadleycell/trend_cell_edges.ncl
        hemisphere: NH
        method: uas
        MME: r1i1p1  #r1i1p1 from each model
#        MME: all

  SH_edge_trend_ANN:
    description: calculate pdf of trends in annual mean SH Hadley cell edges
    variables:
      uas:
        <<: *variable
    scripts:
      trend:
        <<: *trend_setting
        hemisphere: SH

  SH_edge_trend_DJF:
    description: calculate pdf of trends in DJF SH Hadley cell edges
    variables:
      uas:
        <<: *variable
        preprocessor: pp_DJF_zonalmean      
    scripts:
      trend: 
        <<: *trend_setting
        hemisphere: SH

  draw:
    description: draw pdfs
    scripts:
      draw_pdf:
        script: ar6ch3_hadleycell/draw_pdf.ncl
        layout: [1, 3]
        ancestors: ['*/trend']

