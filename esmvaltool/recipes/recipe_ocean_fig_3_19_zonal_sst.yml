# ESMValTool
# recipe_OceanPhysics.yml
---
documentation:
  description: |
    Recipe to produce figure 3.19 for IPCC WG1

  authors:
    - demora_lee

  references:
    - demora2018gmd

  projects:
    - ukesm


# TODO: Add additional models in CMIP5, CMIP3 and CMIP6
# TODO: Increase time range to match fig 3.17
#
datasets:
    # CMIP5
    - {dataset: ACCESS1-0, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: ACCESS1-3, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: bcc-csm1-1-m, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: bcc-csm1-1, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: CanCM4, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: CanESM2, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: CCSM4, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: CESM1-BGC, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: CESM1-CAM5-1-FV2, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: CESM1-CAM5, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: CESM1-FASTCHEM, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: CESM1-WACCM, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: CMCC-CESM, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: CMCC-CM, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: CMCC-CMS, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: CNRM-CM5-2, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: CNRM-CM5, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: CSIRO-Mk3-6-0, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: FGOALS-g2, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: GISS-E2-H-CC, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: GISS-E2-H, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: GISS-E2-R-CC, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: GISS-E2-R, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: HadCM3, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: HadGEM2-AO, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: HadGEM2-CC, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: HadGEM2-ES, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: IPSL-CM5A-LR, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: IPSL-CM5A-MR, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: IPSL-CM5B-LR, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: MIROC-ESM-CHEM, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: MIROC-ESM, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: MPI-ESM-LR, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: MPI-ESM-MR, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: MPI-ESM-P, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: MRI-CGCM3, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: MRI-ESM1, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: NorESM1-M, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: NorESM1-ME, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}


# CMIP6 data (available on 2019-08-23)
    # - {dataset: AWI-CM-1-1-MR , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f1, grid: gn} # [problem with regrid
    # - {dataset: BCC-CSM2-MR , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f1, grid: gn } #  does not match coordinate rank
    # - {dataset: BCC-ESM1 , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f1, grid: gn} #  does not match coordinate rank
    - {dataset: CAMS-CSM1-0 , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f1, grid: gn} # problem with lat/lon
    - {dataset: CanESM5 , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f1, grid: gn} # problem with lat/lon
    - {dataset: CNRM-CM6-1 , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f2, grid: gn}
    - {dataset: CNRM-ESM2-1 , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f2, grid: gn}
    # - {dataset: EC-Earth3 , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f1, grid: gn} # tos absent
    - {dataset: EC-Earth3-Veg , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f1, grid: gn}
    - {dataset: IPSL-CM6A-LR , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f1, grid: gn}
    - {dataset: MIROC6 , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f1, grid: gn}
    - {dataset: HadGEM3-GC31-LL , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f3, grid: gn}
    - {dataset: UKESM1-0-LL , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f2, grid: gn}
    - {dataset: GISS-E2-1-G , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f1, grid: gn}
    - {dataset: GISS-E2-1-H , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f1, grid: gn}
    - {dataset: CESM2 , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f1, grid: gn}
    - {dataset: GFDL-CM4 , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f1, grid: gn}
    - {dataset: SAM0-UNICON , project: CMIP6, mip: Omon, exp: historical, ensemble: r1i1p1f1, grid: gn}

preprocessors:
  prep_3_19a:
    custom_order: true
#    time_average:
    climate_statistics:
      operator: mean
      period: full
    regrid:
      target_grid: 1x1
      scheme: linear
    zonal_means:
      coordinate: longitude
      mean_type: mean

  prep_3_19b:
    custom_order: true
#    time_average:
    climate_statistics:
      operator: mean
      period: full
    regrid:
      target_grid: 1x1
      scheme: linear
    extract_region:
      start_longitude: 0.
      end_longitude: 360.
      start_latitude: -10.
      end_latitude: 10.
    zonal_means:
      coordinate: latitude
      mean_type: mean

  prep_3_19a_theteo:
    custom_order: true
    climate_statistics:
      operator: mean
      period: full
#    time_average:
    extract_levels:
      levels:  [0., ]
      scheme: linear_horizontal_extrapolate_vertical
    regrid: # This should really be after the extract_levels, but it doesn't work that way around!
      target_grid: 1x1
      scheme: linear
    zonal_means:
      coordinate: longitude
      mean_type: mean

  prep_3_19b_theteo:
    custom_order: true
    climate_statistics:
      operator: mean
      period: full
#    time_average:
    extract_levels:
      levels:  [0., ]
      scheme: linear_horizontal_extrapolate_vertical
    regrid: # This should really be after the extract_levels, but it doesn't work that way around!
      target_grid: 1x1
      scheme: linear
    extract_region:
      start_longitude: 0.
      end_longitude: 360.
      start_latitude: -10.
      end_latitude: 10.
    zonal_means:
      coordinate: latitude
      mean_type: mean

diagnostics:
  diag_3_19:
    variables:
    # tos is the correct version, but need to adapt HadISST to the esmvaltool v2.
    # please run only tos or thetao (preferably tos!)

      tos_zonal:
        short_name: tos # ocean surface temperature
        preprocessor: prep_3_19a
        field: TO2M
        start_year: 1975
        end_year: 1999
        additional_datasets:
        - {dataset: HadISST, project: OBS, field: T2Ms, type: reanaly, version: 1, tier: 2}

      tos_equator:
        short_name: tos # ocean surface temperature
        preprocessor: prep_3_19b
        field: TO2M
        start_year: 1975
        end_year: 1999
        additional_datasets:
        - {dataset: HadISST, project: OBS, field: T2Ms, type: reanaly, version: 1, tier: 2}

    #   thetao_zonal:
    #     short_name: thetao # ocean 3d temperature
    #     preprocessor: prep_3_19a_theteo
    #     field: TO3M
    #     start_year: 2000
    #     end_year: 2000
    #     additional_datasets:
    #     - {dataset: WOA,  project: obs4mips,  level: L3, version: clim,  tier: 3, start_year: 2000,  end_year: 2000}
      #
    #   thetao_equator:
    #     short_name: thetao # ocean 3d temperature
    #     preprocessor: prep_3_19b_theteo
    #     field: TO3M
    #     start_year: 2000
    #     end_year: 2000
    #     additional_datasets:
    #     - {dataset: WOA,  project: obs4mips,  level: L3, version: clim,  tier: 3, start_year: 2000,  end_year: 2000}

    scripts:
      diagnostic_3_19:
        script: ocean/diagnostic_fig_3_19_zonal_sst.py
        # observational_dataset: {dataset: WOA, project: obs4mips,}
        observational_dataset: {dataset: HadISST, project: OBS,}
