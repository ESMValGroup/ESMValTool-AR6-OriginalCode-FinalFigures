# ESMValTool
# recipe_perfmetrics_CMIP5.yml
---
documentation:
  description: |
    Recipe for plotting the performance metrics for the CMIP5 datasets,
    including the standard ECVs as in Gleckler et al., and some additional
    variables (like ozone, sea-ice, aerosol...)

  authors:
    - frank_franziska
    - righi_mattia
    - eyring_veronika

  maintainer:
    - righi_mattia

  references:
    - gleckler08jgr

  projects:
    - esmval
    - embrace
    - crescendo
    - c3s-magic
    - cmug

preprocessors:
  ppALL:
    extract_levels:
      levels: reference_dataset
      scheme: linear
    regrid:
      target_grid: reference_dataset
      scheme: linear
    mask_fillvalues:
      threshold_fraction: 0.95
    multi_model_statistics:
      span: overlap
      statistics: [mean, median]
      exclude: [reference_dataset]

datasets:
  - {dataset: BCC-CSM2-MR, grid: gn}
  - {dataset: BCC-ESM1, grid: gn}
  - {dataset: CAMS-CSM1-0, grid: gn}
  - {dataset: CanESM5, grid: gn}
  - {dataset: CESM2, grid: gn}
  - {dataset: CESM2-WACCM, grid: gn, institute: NCAR}
  - {dataset: CNRM-CM6-1, ensemble: r1i1p1f2}
  - {dataset: CNRM-ESM2-1, ensemble: r1i1p1f2}
  - {dataset: E3SM-1-0}
  - {dataset: EC-Earth3, ensemble: r22i1p1f1}
  - {dataset: EC-Earth3-Veg}
  - {dataset: GFDL-CM4, grid: gr1}
  - {dataset: GFDL-ESM4, grid: gr1}
  - {dataset: GISS-E2-1-G, grid: gn}
  - {dataset: GISS-E2-1-G-CC, grid: gn, institute: NASA-GISS}
  - {dataset: GISS-E2-1-H, grid: gn}
  - {dataset: HadGEM3-GC31-LL, ensemble: r1i1p1f3, grid: gn}
  - {dataset: IPSL-CM6A-LR}
  #- {dataset: MCM-UA-1-0, grid: gn} no data
  - {dataset: MIROC6, grid: gn}
  - {dataset: MIROC-ES2L, ensemble: r1i1p1f2, grid: gn}
  - {dataset: MPI-ESM1-2-HR, grid: gn}
  - {dataset: MRI-ESM2-0, grid: gn}
  - {dataset: NESM3, grid: gn}
  #- {dataset: NorCPM1, institute: NCC, ensemble: r24i1p1f1, grid: gn} no data
  - {dataset: SAM0-UNICON, grid: gn}
  - {dataset: UKESM1-0-LL, ensemble: r1i1p1f2, grid: gn}
  - {dataset: ERA-Interim, project: OBS6, type: reanaly, version: 1, tier: 3}
  #- {dataset: ERA5, project: OBS6, type: reanaly, version: 1, tier: 3}


diagnostics:

  ### ta: AIR TEMPERATURE (zonal) #############################################
  taZONAL:
    description: Air temperature zonal mean
    themes:
      - phys
    realms:
      - atmos
    variables:
      ta:
        preprocessor: ppALL
        reference_dataset: ERA-Interim #ERA5
        mip: Amon
        project: CMIP6
        exp: historical
        grid: gr
        ensemble: r1i1p1f1
        start_year: 1995
        end_year: 2014
    scripts:
      zonal: &zonal_settings
        script: perfmetrics/main.ncl
        # Plot type ('cycle', 'zonal', 'latlon', 'cycle_latlon', 'cycle_zonal')
        plot_type: zonal
        # Time average ('opt' argument of time_operations.ncl)
        time_avg: annualclim
        # Region ('global', 'trop', 'nhext', 'shext')
        region: global
        plot_units: degC
        # Draw difference plots
        plot_diff: true
        # Calculate t-test in difference plots
        t_test: true
        # Confidence level for the t-test
        conf_level: 0.95
        # Mask non-significant values with stippling
        stippling: true
        # Contour levels for absolute plot
        #abs_levs: [200, 210, 220, 230, 240, 250, 260, 270, 280, 290, 300]
        abs_levs: [-60, -50, -40, -30, -20, -10,  0, 10, 20, 30, 40, 50, 60]
        abs_col: "ipcc-ar6_temperature_div.rgb"
        # Contour levels for difference plot
        diff_levs: [-10, -9, -8, -7, -6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
        diff_col: "ipcc-ar6_temperature_div.rgb"


  ### hus: SPECIFIC HUMIDITY ########################################
  husZONAL:
    description: Specific humidity zonal mean
    themes:
      - phys
    realms:
      - atmos
    variables:
      hus:
        preprocessor: ppALL
        reference_dataset: ERA-Interim #ERA5
        mip: Amon
        project: CMIP6
        exp: historical
        grid: gr
        ensemble: r1i1p1f1
        start_year: 1995
        end_year: 2014
    scripts:
      zonal:
        script: perfmetrics/main.ncl
        # Plot type ('cycle', 'zonal', 'latlon', 'cycle_latlon', 'cycle_zonal')
        plot_type: zonal
        # Time average ('opt' argument of time_operations.ncl)
        time_avg: annualclim
        # Region ('global', 'trop', 'nhext', 'shext')
        region: global
        plot_units: 1e-6
        # Draw difference plots
        plot_diff: true
        # Calculate t-test in difference plots
        t_test: true
        # Confidence level for the t-test
        conf_level: 0.95
        # Mask non-significant values with stippling
        stippling: true
        # Contour levels for absolute plot
        #abs_levs: [1.e-6, 0.5e-5, 1.e-5, 0.5e-4, 1.e-4, 0.5e-3, 1.e-3, 0.5e-2, 1.e-2]
        abs_levs: [1, 5, 10, 50, 100, 500, 1000, 5000, 10000]
        abs_col: "ipcc-ar6_precipitation_seq.rgb"
        # Contour levels for difference plot
        #diff_levs: [-2, -1.5, -1, -0.5, 0, 0.5, 1, 1.5, 2]
        #diff_levs: [-1.e-3, -1.e-4, -1.e-5, -1.e-6, -1.e-7, 0, 1.e-7, 1.e-6, 1.e-5, 1.e-4, 1.e-3]
        diff_rel: true
        #diff_levs: [-1000., -100., -10., -1., -0.1, 0, 0.1, 1., 10., 100., 1000.]
        diff_levs: [-0.3, -0.25, -0.2, -0.15, -0.1, -0.05, 0, 0.05, 0.1, 0.15, 0.2, 0.25, 0.3]
        #diff_levs: [-0.2, -0.18, -0.16, -0.14, -0.12, -0.1, -0.08, -0.06, -0.04, -0.02, 0, 0.02, 0.04, 0.06, 0.08, 0.1, 0.12, 0.14, 0.16, 0.18, 0.2]
        diff_col: "ipcc-ar6_precipitation_div.rgb"

  ### ua: EASTWARD WIND ########################################
  uaZONAL:
    description: Eastward wind zonal mean
    themes:
      - phys
    realms:
      - atmos
    variables:
      ua:
        preprocessor: ppALL
        reference_dataset: ERA-Interim #ERA5
        mip: Amon
        project: CMIP6
        exp: historical
        grid: gr
        ensemble: r1i1p1f1
        start_year: 1995
        end_year: 2014
    scripts:
      zonal:
        #<<: *zonal_settings
        script: perfmetrics/main.ncl
        # Plot type ('cycle', 'zonal', 'latlon', 'cycle_latlon', 'cycle_zonal')
        plot_type: zonal
        # Time average ('opt' argument of time_operations.ncl)
        time_avg: annualclim
        # Region ('global', 'trop', 'nhext', 'shext')
        region: global
        # Draw difference plots
        plot_diff: true
        # Calculate t-test in difference plots
        t_test: true
        # Confidence level for the t-test
        conf_level: 0.95
        # Mask non-significant values with stippling
        stippling: true
        # Contour levels for absolute plot
        abs_levs: [-30., -25., -20., -15., -10., -5., 0., 5., 10., 15., 20., 25., 30.]
        abs_col: "ipcc-ar6_wind_div.rgb"
        # Contour levels for difference plot
        diff_levs: [-10, -9, -8, -7, -6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
        diff_col: "ipcc-ar6_wind_div.rgb"
