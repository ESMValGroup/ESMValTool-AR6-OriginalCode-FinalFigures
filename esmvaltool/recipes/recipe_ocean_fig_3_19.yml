# ESMValTool
# recipe_OceanPhysics.yml
---
documentation:
  description: |
    Recipe to produce figure 3.19 for IPCC WG1

  authors:
    - demo_le

  references:
    - demora2018gmd

  projects:
    - ukesm


# TODO: Add additional models in CMIP5, CMIP3 and CMIP6
# TODO: Increase time range to match fig 3.17

datasets:
    - {dataset: HadGEM2-ES, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: HadGEM2-CC, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    - {dataset: CanESM2,    project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}

    # - {dataset: ACCESS1-0, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # - {dataset: ACCESS1-3, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # - {dataset: bcc-csm1-1-m, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # - {dataset: bcc-csm1-1, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # - {dataset: CanESM2, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # # - {dataset: CCSM4, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: CESM1-BGC, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: CESM1-CAM5-1-FV2, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: CESM1-CAM5, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # # - {dataset: CESM1-FASTCHEM, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: CESM1-WACCM, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: CMCC-CESM, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # # - {dataset: CMCC-CM, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # - {dataset: CMCC-CMS, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # - {dataset: CNRM-CM5-2, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # - {dataset: CNRM-CM5, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # - {dataset: CSIRO-Mk3-6-0, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # - {dataset: EC-EARTH, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # - {dataset: FGOALS-g2, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: GFDL-CM2p1, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: GFDL-CM3, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: GFDL-ESM2G, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: GFDL-ESM2M, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # - {dataset: GISS-E2-R-CC, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # - {dataset: GISS-E2-R, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # - {dataset: HadGEM2-CC, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # - {dataset: HadGEM2-ES, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # - {dataset: inmcm4, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: IPSL-CM5A-LR, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: IPSL-CM5A-MR, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: IPSL-CM5B-LR, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: MIROC-ESM-CHEM, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: MIROC-ESM, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: MIROC4h, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: MIROC5, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: MPI-ESM-LR, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: MPI-ESM-MR, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: MPI-ESM-P, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: MRI-CGCM3, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}
    # # - {dataset: MRI-ESM1, project: CMIP5, mip: Omon, exp: historical, ensemble: r1i1p1}

preprocessors:
  prep_3_19a:
    custom_order: true
    time_average:
    regrid:
      target_grid: 1x1
      scheme: linear
    zonal_means:
      coordinate: longitude
      mean_type: mean

  prep_3_19b:
    custom_order: true
    time_average:
    regrid:
      target_grid: 1x1
      scheme: linear
    extract_region:
      start_longitude: 0.
      end_longitude: 360.
      start_latitude: -10.
      end_latitude: 10.
    zonal_means:
      coordinate: latitude
      mean_type: mean

  prep_3_19a_theteo:
    custom_order: true
    time_average:
    extract_levels:
      levels:  [0., ]
      scheme: linear_horizontal_extrapolate_vertical
    regrid: # This should really be after the extract_levels, but it doesn't work that way around!
      target_grid: 1x1
      scheme: linear
    zonal_means:
      coordinate: longitude
      mean_type: mean

  prep_3_19b_theteo:
    custom_order: true
    time_average:
    extract_levels:
      levels:  [0., ]
      scheme: linear_horizontal_extrapolate_vertical
    regrid: # This should really be after the extract_levels, but it doesn't work that way around!
      target_grid: 1x1
      scheme: linear
    extract_region:
      start_longitude: 0.
      end_longitude: 360.
      start_latitude: -10.
      end_latitude: 10.
    zonal_means:
      coordinate: latitude
      mean_type: mean

diagnostics:
  diag_3_19:
    variables:
    # tos is the correct version, but need to adapt HadISST to the esmvaltool v2.
    # please run only tos or thetao (preferably tos!)

    #   tos_zonal:
    #     short_name: tos # ocean surface temperature
    #     preprocessor: prep_3_19a
    #     field: TO2M
    #     start_year: 1999
    #     end_year: 2000
    #     additional_datasets:
    #     - {dataset: HadISST, project: OBS, field: T2Ms, type: reanaly, version: 1, tier: 2}
    #     # - {dataset: CORA,  project: OBS,  version: 51,  tier: 3, start_year: 1950,  end_year: 2008}
    #     # - {dataset: HadISST,  project: OBS,  version: 51,  tier: 3, start_year: 1950,  end_year: 2008}
      #
    #   tos_equator:
    #     short_name: tos # ocean surface temperature
    #     preprocessor: prep_3_19b
    #     field: TO2M
    #     start_year: 1999
    #     end_year: 2000
    #     additional_datasets:
    #     # - {dataset: WOA,  project: obs4mips,  level: L3, version: clim,  tier: 3, start_year: 2000,  end_year: 2000}
    #     - {dataset: HadISST, project: OBS, field: T2Ms, type: reanaly, version: 1, tier: 2}

      thetao_zonal:
        short_name: thetao # ocean 3d temperature
        preprocessor: prep_3_19a_theteo
        field: TO3M
        start_year: 2000
        end_year: 2000
        additional_datasets:
        - {dataset: WOA,  project: obs4mips,  level: L3, version: clim,  tier: 3, start_year: 2000,  end_year: 2000}

      thetao_equator:
        short_name: thetao # ocean 3d temperature
        preprocessor: prep_3_19b_theteo
        field: TO3M
        start_year: 2000
        end_year: 2000
        additional_datasets:
        - {dataset: WOA,  project: obs4mips,  level: L3, version: clim,  tier: 3, start_year: 2000,  end_year: 2000}

    scripts:
      diagnostic_3_19:
        script: ocean/diagnostic_fig_3_19.py
        observational_dataset: {dataset: WOA, project: obs4mips,}
