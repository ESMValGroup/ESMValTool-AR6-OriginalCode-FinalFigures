# ESMValTool
# recipe_bockjgr20.yml 
---
documentation:
  description: |
    Producing figures from Bock et al., 2020, JGR

  authors:
    - bock_lisa
    - lauer_axel

  references:
    - gleckler08jgr

preprocessors:
  ppALL:
    extract_levels:
      levels: reference_dataset
      scheme: linear
    regrid:
      target_grid: reference_dataset
      scheme: linear
    mask_fillvalues:
      threshold_fraction: 0.95
    multi_model_statistics:
      span: overlap
      statistics: [mean, median]
      exclude: [reference_dataset]

datasets:
  - {dataset: ACCESS-CM2, grid: gn, institute: CSIRO-ARCCSS} 
  - {dataset: ACCESS-ESM1-5, grid: gn, institute: CSIRO}
  - {dataset: AWI-CM-1-1-MR, grid: gn}
  - {dataset: AWI-ESM-1-1-LR, grid: gn}
  - {dataset: BCC-CSM2-MR, grid: gn}
  - {dataset: BCC-ESM1, grid: gn}
  - {dataset: CAMS-CSM1-0, grid: gn}
  - {dataset: CanESM5, grid: gn}
  #- {dataset: CanESM5-CanOE, grid: gn, ensemble: r1i1p2f1} #no hus data
  - {dataset: CESM2, grid: gn}
  - {dataset: CESM2-FV2, grid: gn, institute: NCAR}
  - {dataset: CESM2-WACCM, grid: gn, institute: NCAR}
  - {dataset: CESM2-WACCM-FV2, grid: gn, institute: NCAR}
  - {dataset: CIESM}
  - {dataset: CNRM-CM6-1, ensemble: r1i1p1f2}
  - {dataset: CNRM-CM6-1-HR, ensemble: r1i1p1f2}
  - {dataset: CNRM-ESM2-1, ensemble: r1i1p1f2}
  - {dataset: E3SM-1-0}
  - {dataset: E3SM-1-1, institute: E3SM-Project}
  - {dataset: E3SM-1-1-ECA, institute: E3SM-Project}
  #- {dataset: EC-Earth3, ensemble: r22i1p1f1}
  #- {dataset: EC-Earth3-Veg} #no hus data after 1995
  - {dataset: FGOALS-f3-L} 
  - {dataset: FGOALS-g3, grid: gn}
  #- {dataset: FIO-ESM-2-0, grid: gn} #lat is not monotonic
  - {dataset: GFDL-CM4, grid: gr1}
  - {dataset: GFDL-ESM4, grid: gr1}
  - {dataset: GISS-E2-1-G, grid: gn}
  - {dataset: GISS-E2-1-G-CC, grid: gn, institute: NASA-GISS}
  - {dataset: GISS-E2-1-H, grid: gn}
  - {dataset: HadGEM3-GC31-LL, ensemble: r1i1p1f3, grid: gn}
  - {dataset: HadGEM3-GC31-MM, ensemble: r1i1p1f3, grid: gn}
  - {dataset: INM-CM4-8, grid: gr1}
  - {dataset: INM-CM5-0, grid: gr1}
  - {dataset: IPSL-CM6A-LR}
  - {dataset: KACE-1-0-G}
  - {dataset: MCM-UA-1-0, grid: gn} 
  - {dataset: MIROC6, grid: gn}
  - {dataset: MIROC-ES2L, ensemble: r1i1p1f2, grid: gn}
  - {dataset: MPI-ESM-1-2-HAM, grid: gn}
  - {dataset: MPI-ESM1-2-HR, grid: gn}
  - {dataset: MPI-ESM1-2-LR, grid: gn}
  - {dataset: MRI-ESM2-0, grid: gn}
  - {dataset: NESM3, grid: gn}
  - {dataset: NorCPM1, grid: gn, institute: NCC}
  - {dataset: NorESM2-LM, grid: gn, institute: NCC}
  - {dataset: NorESM2-MM, grid: gn, institute: NCC}
  - {dataset: SAM0-UNICON, grid: gn}
  - {dataset: TaiESM1, grid: gn}
  - {dataset: UKESM1-0-LL, ensemble: r1i1p1f2, grid: gn}
  - {dataset: ERA-Interim, project: OBS6, type: reanaly, version: 1, tier: 3}
  #- {dataset: ERA5, project: OBS6, type: reanaly, version: 1, tier: 3}


diagnostics:

  ### ta: AIR TEMPERATURE (zonal) #############################################
  taZONAL:
    description: Air temperature zonal mean
    themes:
      - phys
    realms:
      - atmos
    variables:
      ta: &var_settings
        preprocessor: ppALL
        reference_dataset: ERA-Interim #ERA5
        mip: Amon
        project: CMIP6
        exp: historical
        grid: gr
        ensemble: r1i1p1f1
        start_year: 1995
        end_year: 2014
    scripts:
      zonal: &zonal_settings
        script: perfmetrics/main.ncl
        # Plot type ('cycle', 'zonal', 'latlon', 'cycle_latlon', 'cycle_zonal')
        plot_type: zonal
        # Time average ('opt' argument of time_operations.ncl)
        time_avg: annualclim
        # Region ('global', 'trop', 'nhext', 'shext')
        region: global
        plot_units: degC
        # Draw difference plots
        plot_diff: true
        # Calculate t-test in difference plots
        t_test: true
        # Confidence level for the t-test
        conf_level: 0.95
        # Mask non-significant values with stippling
        stippling: true
        # Contour levels for absolute plot
        #abs_levs: [200, 210, 220, 230, 240, 250, 260, 270, 280, 290, 300]
        abs_levs: [-60, -50, -40, -30, -20, -10,  0, 10, 20, 30, 40, 50, 60]
        abs_col: "ipcc-ar6_temperature_div.rgb"
        # Contour levels for difference plot
        diff_levs: [-10, -9, -8, -7, -6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
        diff_col: "ipcc-ar6_temperature_div.rgb"


  ### hus: SPECIFIC HUMIDITY ########################################
  husZONAL:
    description: Specific humidity zonal mean
    themes:
      - phys
    realms:
      - atmos
    variables:
      hus:
        <<: *var_settings
    scripts:
      zonal:
        <<: *zonal_settings
        plot_units: 1e-6
        # Contour levels for absolute plot
        abs_levs: [1, 5, 10, 50, 100, 500, 1000, 5000, 10000]
        abs_col: "ipcc-ar6_precipitation_seq.rgb"
        # Contour levels for difference plot
        diff_rel: true
        diff_levs: [-0.3, -0.25, -0.2, -0.15, -0.1, -0.05, 0, 0.05, 0.1, 0.15, 0.2, 0.25, 0.3]
        diff_col: "ipcc-ar6_precipitation_div.rgb"

  ### ua: EASTWARD WIND ########################################
  uaZONAL:
    description: Eastward wind zonal mean
    themes:
      - phys
    realms:
      - atmos
    variables:
      ua:
        <<: *var_settings
    scripts:
      zonal:
        <<: *zonal_settings
        plot_units: m s-1
        # Contour levels for absolute plot
        abs_levs: [-30., -25., -20., -15., -10., -5., 0., 5., 10., 15., 20., 25., 30.]
        abs_col: "ipcc-ar6_wind_div.rgb"
        # Contour levels for difference plot
        diff_levs: [-10, -9, -8, -7, -6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
        diff_col: "ipcc-ar6_wind_div.rgb"
