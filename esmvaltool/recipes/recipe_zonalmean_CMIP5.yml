# ESMValTool
# recipe_perfmetrics_CMIP5.yml
---
documentation:
  description: |
    Recipe for plotting the performance metrics for the CMIP5 datasets,
    including the standard ECVs as in Gleckler et al., and some additional
    variables (like ozone, sea-ice, aerosol...)

  authors:
    - frank_franziska
    - righi_mattia
    - eyring_veronika

  maintainer:
    - righi_mattia

  references:
    - gleckler08jgr

  projects:
    - esmval
    - embrace
    - crescendo
    - c3s-magic
    - cmug

preprocessors:
  ppALL:
    extract_levels:
      levels: reference_dataset
      scheme: linear
    regrid:
      target_grid: reference_dataset
      scheme: linear
    mask_fillvalues:
      threshold_fraction: 0.95
    multi_model_statistics:
      span: overlap
      statistics: [mean, median]
      exclude: [reference_dataset]

datasets:
  - {dataset: ACCESS1-0}
  - {dataset: ACCESS1-3}
  - {dataset: bcc-csm1-1}
  - {dataset: bcc-csm1-1-m}
  - {dataset: BNU-ESM}
  #- {dataset: CanCM4} no hus
  - {dataset: CanESM2}
  - {dataset: CCSM4}
  - {dataset: CESM1-BGC}
  - {dataset: CESM1-CAM5}
  - {dataset: CESM1-CAM5-1-FV2}
  - {dataset: CESM1-FASTCHEM}
  - {dataset: CESM1-WACCM}
  - {dataset: CMCC-CESM}
  - {dataset: CMCC-CM}
  - {dataset: CMCC-CMS}
  - {dataset: CNRM-CM5}
  - {dataset: CNRM-CM5-2}
  - {dataset: CSIRO-Mk3-6-0}
  - {dataset: EC-EARTH, ensemble: r6i1p1}
  #- {dataset: FGOALS-g2} Can not concatenate cubes
  - {dataset: FGOALS-s2, ensemble: r2i1p1}
  - {dataset: FIO-ESM}
  - {dataset: GFDL-CM2p1}
  - {dataset: GFDL-CM3}
  - {dataset: GFDL-ESM2G}
  - {dataset: GFDL-ESM2M}
  - {dataset: GISS-E2-H, ensemble: r1i1p2}
  - {dataset: GISS-E2-H-CC}
  - {dataset: GISS-E2-R, ensemble: r1i1p2}
  - {dataset: GISS-E2-R-CC}
  #- {dataset: HadCM3} no hus
  - {dataset: HadGEM2-AO}
  - {dataset: HadGEM2-CC}
  - {dataset: HadGEM2-ES}
  - {dataset: inmcm4}
  - {dataset: IPSL-CM5A-LR}
  - {dataset: IPSL-CM5A-MR}
  - {dataset: IPSL-CM5B-LR}
  - {dataset: MIROC4h}
  - {dataset: MIROC5}
  - {dataset: MIROC-ESM}
  - {dataset: MIROC-ESM-CHEM}
  - {dataset: MPI-ESM-LR}
  - {dataset: MPI-ESM-MR}
  - {dataset: MPI-ESM-P}
#  - {dataset: MRI-CGCM3}
#  - {dataset: MRI-ESM1}
#  - {dataset: NorESM1-M}
#  - {dataset: NorESM1-ME}
  - {dataset: ERA-Interim, project: OBS6, type: reanaly, version: 1, tier: 3}
  #- {dataset: ERA5, project: OBS6, type: reanaly, version: 1, tier: 3}


diagnostics:

  ### ta: AIR TEMPERATURE (zonal) #############################################
  taZONAL:
    description: Air temperature zonal mean
    themes:
      - phys
    realms:
      - atmos
    variables:
      ta:
        preprocessor: ppALL
        reference_dataset: ERA-Interim #ERA5
        mip: Amon
        project: CMIP5
        exp: historical
        ensemble: r1i1p1
        start_year: 1995
        end_year: 2004
    scripts:
      zonal: &zonal_settings
        script: perfmetrics/main.ncl
        # Plot type ('cycle', 'zonal', 'latlon', 'cycle_latlon', 'cycle_zonal')
        plot_type: zonal
        # Time average ('opt' argument of time_operations.ncl)
        time_avg: annualclim
        # Region ('global', 'trop', 'nhext', 'shext')
        region: global
        plot_units: degC
        # Draw difference plots
        plot_diff: true
        # Calculate t-test in difference plots
        t_test: true
        # Confidence level for the t-test
        conf_level: 0.95
        # Mask non-significant values with stippling
        stippling: true
        # Contour levels for absolute plot
        abs_levs: [-60, -50, -40, -30, -20, -10,  0, 10, 20, 30, 40, 50, 60]
        abs_col: "ipcc-ar6_temperature_div.rgb"
        # Contour levels for difference plot
        diff_levs: [-10, -9, -8, -7, -6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
        diff_col: "ipcc-ar6_temperature_div.rgb"


  ### hus: SPECIFIC HUMIDITY ########################################
  husZONAL:
    description: Specific humidity zonal mean
    themes:
      - phys
    realms:
      - atmos
    variables:
      hus:
        preprocessor: ppALL
        reference_dataset: ERA-Interim #ERA5
        mip: Amon
        project: CMIP5
        exp: historical
        ensemble: r1i1p1
        start_year: 1995
        end_year: 2004
    scripts:
      zonal:
        script: perfmetrics/main.ncl
        # Plot type ('cycle', 'zonal', 'latlon', 'cycle_latlon', 'cycle_zonal')
        plot_type: zonal
        # Time average ('opt' argument of time_operations.ncl)
        time_avg: annualclim
        # Region ('global', 'trop', 'nhext', 'shext')
        region: global
        plot_units: 1e-6
        # Draw difference plots
        plot_diff: true
        # Calculate t-test in difference plots
        t_test: true
        # Confidence level for the t-test
        conf_level: 0.95
        # Mask non-significant values with stippling
        stippling: true
        # Contour levels for absolute plot
        abs_levs: [1, 5, 10, 50, 100, 500, 1000, 5000, 10000]
        abs_col: "ipcc-ar6_precipitation_seq.rgb"
        # Contour levels for difference plot
        diff_levs: [-1000., -100., -10., -1., -0.1, 0, 0.1, 1., 10., 100., 1000.]
        diff_col: "ipcc-ar6_precipitation_div.rgb"


  ### ua: EASTWARD WIND ########################################
  uaZONAL:
    description: Eastward wind zonal mean
    themes:
      - phys
    realms:
      - atmos
    variables:
      ua:
        preprocessor: ppALL
        reference_dataset: ERA-Interim #ERA5
        mip: Amon
        project: CMIP5
        exp: historical
        ensemble: r1i1p1
        start_year: 1995
        end_year: 2004
    scripts:
      zonal:
        script: perfmetrics/main.ncl
        # Plot type ('cycle', 'zonal', 'latlon', 'cycle_latlon', 'cycle_zonal')
        plot_type: zonal
        # Time average ('opt' argument of time_operations.ncl)
        time_avg: annualclim
        # Region ('global', 'trop', 'nhext', 'shext')
        region: global
        # Draw difference plots
        plot_diff: true
        # Calculate t-test in difference plots
        t_test: true
        # Confidence level for the t-test
        conf_level: 0.95
        # Mask non-significant values with stippling
        stippling: true
        # Contour levels for absolute plot
        abs_levs: [-30., -25., -20., -15., -10., -5., 0., 5., 10., 15., 20., 25., 30.]
        abs_col: "ipcc-ar6_wind_div.rgb"
        # Contour levels for difference plot
        diff_levs: [-10, -9, -8, -7, -6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
        diff_col: "ipcc-ar6_wind_div.rgb"
