# ESMValTool
# recipe_fig3-3_gmst.yml
---
documentation:

  description: |
    Producing selected figures from IPCC WGI AR6, chap. 3

  authors:
    - bock_lisa

  maintainer:
    - bock_lisa

  references:
    - flato13ipcc
    - cowtan15grl

  projects:
    - ipcc_ar6


preprocessors:

  regrid_5_5:
    regrid:
      target_grid: 5x5
      scheme: linear

datasets:
  # - {dataset: AWI-CM-1-1-MR, grid: gn, start_year: 1851} #no siconc data
  # - {dataset: BCC-CSM2-MR, grid: gn} #no siconc data
  # - {dataset: BCC-ESM1, grid: gn} #no siconc data
  # - {dataset: CAMS-CSM1-0, grid: gn} #no fx data
  - {dataset: CanESM5, grid: gn}
  # - {dataset: CESM2, grid: gn} #fix for siconc failed
  # - {dataset: CESM2-WACCM, grid: gn, institute: NCAR} #fix for siconc failed
  # - {dataset: EC-Earth3, ensemble: r22i1p1f1} #no complete dataset for both experiments
  # - {dataset: GISS-E2-1-G, grid: gn} #no sftlf data
  # - {dataset: GISS-E2-1-G-CC, grid: gn, institute: NASA-GISS} #no sftlf data
  # - {dataset: HadGEM3-GC31-LL, ensemble: r1i1p1f3, grid: gn} #no sftlf data
  - {dataset: INM-CM4-8, grid: gr1}
  - {dataset: INM-CM5-0, grid: gr1}
  # - {dataset: MCM-UA-1-0, grid: gn} #no siconc data
  - {dataset: MIROC6, grid: gn}
  - {dataset: MIROC-ES2L, ensemble: r1i1p1f2, grid: gn}
  # - {dataset: MPI-ESM1-2-HR, grid: gn} #no sftlf data
  - {dataset: MPI-ESM1-2-LR, grid: gn} #no ScenarioMIP data yet
  - {dataset: MRI-ESM2-0, grid: gn}
  # - {dataset: NESM3, grid: gn} #no sftlf data
  - {dataset: NorCPM1, ensemble: r24i1p1f1, grid: gn, institute: NCC} #concatinate erros for tas
  # - {dataset: NorESM2-LM, grid: gn, institute: NCC} #no siconc data (but on ESGF)
  - {dataset: SAM0-UNICON, grid: gn} #no ScenarioMIP data yet
  # - {dataset: UKESM1-0-LL, ensemble: r1i1p1f2, grid: gn} #no sftlf data


diagnostics:


  # ***********************************************************************
  # Preprocess data by regridded to HadCRUT4 grid then run masking/blending
  # and attribution code.
  # ***********************************************************************

  fig_test_attribute:
    description: Test of masked and blended surface temperature.
    variables:
      tas: &tas_settings
        preprocessor: regrid_5_5
        reference_dataset: HadCRUT4
        mip: Amon
        project: CMIP6
        exp: historical
        grid: gr
        ensemble: r1i1p1f1
        start_year: 1850
        end_year: 2014
        additional_datasets: &damip_simulations
          - {dataset: CNRM-CM6-1, ensemble: r1i1p1f2}
          # - {dataset: CNRM-CM6-1-HR, ensemble: r1i1p1f2} #no tos data
          - {dataset: CNRM-ESM2-1, ensemble: r2i1p1f2}
          - {dataset: E3SM-1-0} #no ScenarioMIP data on DKRZ
          # - {dataset: EC-Earth3-Veg} concatinate error for siconc
          # - {dataset: GFDL-CM4, grid: gr1} #fix for siconc failed
          # - {dataset: GFDL-ESM4, grid: gr1} #no siconc data
          # - {dataset: GISS-E2-1-H, grid: gn} #no sftlf data
          # - {dataset: IPSL-CM6A-LR} concatinate error for tos
          - {dataset: HadCRUT4, project: OBS, type: ground, version: 1,
             tier: 2}


      tos: &tos_settings
        preprocessor: regrid_5_5
        mip: Omon
        project: CMIP6
        exp: historical
        grid: gn
        ensemble: r1i1p1f1
        start_year: 1850
        end_year: 2014
        additional_datasets:
          - {dataset: CNRM-CM6-1, ensemble: r1i1p1f2}
          # - {dataset: CNRM-CM6-1-HR, ensemble: r1i1p1f2} #no tos data
          - {dataset: CNRM-ESM2-1, ensemble: r2i1p1f2}
          - {dataset: E3SM-1-0, grid: gr} #no ScenarioMIP data on DKRZ
          # - {dataset: EC-Earth3-Veg} concatinate error for siconc
          # - {dataset: GFDL-CM4, grid: gr} #fix for siconc failed
          # - {dataset: GFDL-ESM4, grid: gr} #no siconc data
          # - {dataset: GISS-E2-1-H, grid: gn} #no sftlf data
          # - {dataset: IPSL-CM6A-LR} concatinate error for tos

      siconc:
        <<: *tos_settings
        mip: SImon
        grid: gr
        additional_datasets:
          - {dataset: CNRM-CM6-1, grid: gn, ensemble: r1i1p1f2}
          # - {dataset: CNRM-CM6-1-HR, grid: gn, ensemble: r1i1p1f2} #no tos data
          - {dataset: CNRM-ESM2-1, grid: gn, ensemble: r1i1p1f2}
          - {dataset: E3SM-1-0} #no ScenarioMIP data on DKRZ
          # - {dataset: EC-Earth3-Veg, grid: gn} concatinate error for siconc
          # - {dataset: GFDL-CM4, grid: gr} #fix for siconc failed
          # - {dataset: GFDL-ESM4, grid: gr} #no siconc data
          # - {dataset: GISS-E2-1-H, grid: gr} #no sftlf data
          # - {dataset: IPSL-CM6A-LR, grid: gn} concatinate error for tas

      sftlf:
        <<: *tos_settings
        exp: historical
        mip: fx
        grid: gr
        additional_datasets:
          - {dataset: CNRM-CM6-1, ensemble: r2i1p1f2}
          # - {dataset: CNRM-CM6-1-HR, ensemble: r2i1p1f2} #no tos data
          - {dataset: CNRM-ESM2-1, ensemble: r2i1p1f2}
          - {dataset: E3SM-1-0} #no ScenarioMIP data on DKRZ
          # - {dataset: EC-Earth3-Veg, grid: gn} concatinate error for siconc
          # - {dataset: GFDL-CM4, grid: gr1} #fix for siconc failed
          # - {dataset: GFDL-ESM4, grid: gr} #no siconc data
          # - {dataset: GISS-E2-1-H, grid: gn} #no sftlf data
          # - {dataset: IPSL-CM6A-LR} concatinate error for tas

    scripts:
      fig-3-3:
        # script: ipcc_ar6/gmst_vs_gsat.py
        # script: ipcc_ar6/temperature_anom_blend.py
        script: ipcc_ar6/tsline_blend.ncl
        time_avg: "yearly"
        ts_anomaly: "anom"
        ref_start: 1850
        ref_end: 1900
        plot_units: "degC"
        y_min: -0.5
        y_max: 1.6
        volcanoes: true
        styleset: CMIP6       # Plot style
