# ESMValTool
# recipe_perfmetrics_CMIP5.yml
---
documentation:
  description: |
    Recipe for plotting the performance metrics for the CMIP5 datasets,
    including the standard ECVs as in Gleckler et al., and some additional
    variables (like ozone, sea-ice, aerosol...)

  authors:
    - frank_franziska
    - righi_mattia
    - eyring_veronika

  maintainer:
    - righi_mattia

  references:
    - gleckler08jgr

  projects:
    - esmval
    - embrace
    - crescendo
    - c3s-magic
    - cmug

preprocessors:
  ppALL:
    extract_levels:
      levels: reference_dataset
      scheme: linear
    regrid:
      target_grid: reference_dataset
      scheme: linear
    mask_fillvalues:
      threshold_fraction: 0.95
    multi_model_statistics:
      span: overlap
      statistics: [mean, median]
      exclude: [reference_dataset]

datasets:
  - &cmip3 {dataset: bccr_bcm2_0, project: CMIP3,  mip: A1,  modeling_realm: atm,  exp: 20c3m,  frequency: mo, ensemble: run1}
  - {<<: *cmip3, dataset: cccma_cgcm3_1}
  - {<<: *cmip3, dataset: cccma_cgcm3_1_t63}
  - {<<: *cmip3, dataset: csiro_mk3_0}
  #- {<<: *cmip3, dataset: gfdl_cm2_0}
  #- {<<: *cmip3, dataset: gfdl_cm2_1}
  - {<<: *cmip3, dataset: giss_aom}
  - {<<: *cmip3, dataset: giss_model_e_h}
  - {<<: *cmip3, dataset: giss_model_e_r}
  - {<<: *cmip3, dataset: iap_fgoals1_0_g}
  - {<<: *cmip3, dataset: ingv_echam4}
  - {<<: *cmip3, dataset: inmcm3_0}
  - {<<: *cmip3, dataset: ipsl_cm4}
  - {<<: *cmip3, dataset: miroc3_2_hires}
  - {<<: *cmip3, dataset: miroc3_2_medres}
  #- {<<: *cmip3, dataset: miub_echo_g}
  - {<<: *cmip3, dataset: mpi_echam5}
  #- {<<: *cmip3, dataset: mri_cgcm2_3_2a}
  - {<<: *cmip3, dataset: ncar_ccsm3_0}
  - {<<: *cmip3, dataset: ncar_pcm1}
  - {<<: *cmip3, dataset: ukmo_hadcm3}
  #- {<<: *cmip3, dataset: ukmo_hadgem1}
  - {dataset: ERA-Interim, project: OBS6, type: reanaly, version: 1, tier: 3}
  #- {dataset: ERA5, project: OBS6, type: reanaly, version: 1, tier: 3}


diagnostics:

#  ### ta: AIR TEMPERATURE (zonal) #############################################
#  taZONAL:
#    description: Air temperature zonal mean
#    themes:
#      - phys
#    realms:
#      - atmos
#    variables:
#      ta:
#        preprocessor: ppALL
#        reference_dataset: ERA-Interim #ERA5
#        mip: Amon
#        project: CMIP3
#        exp: 20cm3
#        start_year: 1980
#        end_year: 1999
#    scripts:
#      zonal: &zonal_settings
#        script: perfmetrics/main.ncl
#        # Plot type ('cycle', 'zonal', 'latlon', 'cycle_latlon', 'cycle_zonal')
#        plot_type: zonal
#        # Time average ('opt' argument of time_operations.ncl)
#        time_avg: annualclim
#        # Region ('global', 'trop', 'nhext', 'shext')
#        region: global
#        plot_units: degC
#        # Draw difference plots
#        plot_diff: true
#        # Calculate t-test in difference plots
#        t_test: true
#        # Confidence level for the t-test
#        conf_level: 0.95
#        # Mask non-significant values with stippling
#        stippling: true
#        # Contour levels for absolute plot
#        abs_levs: [-60, -50, -40, -30, -20, -10,  0, 10, 20, 30, 40, 50, 60]
#        abs_col: "ipcc-ar6_temperature_div.rgb"
#        # Contour levels for difference plot
#        diff_levs: [-10, -9, -8, -7, -6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
#        diff_col: "ipcc-ar6_temperature_div.rgb"


  ### hus: SPECIFIC HUMIDITY ########################################
  husZONAL:
    description: Specific humidity zonal mean
    themes:
      - phys
    realms:
      - atmos
    variables:
      hus:
        preprocessor: ppALL
        reference_dataset: ERA-Interim #ERA5
        mip: Amon
        project: CMIP6
        exp: historical
        grid: gr
        ensemble: r1i1p1f1
        start_year: 1980
        end_year: 1999
    scripts:
      zonal:
        script: perfmetrics/main.ncl
        # Plot type ('cycle', 'zonal', 'latlon', 'cycle_latlon', 'cycle_zonal')
        plot_type: zonal
        # Time average ('opt' argument of time_operations.ncl)
        time_avg: annualclim
        # Region ('global', 'trop', 'nhext', 'shext')
        region: global
        plot_units: 1e-6
        # Draw difference plots
        plot_diff: true
        # Calculate t-test in difference plots
        t_test: true
        # Confidence level for the t-test
        conf_level: 0.95
        # Mask non-significant values with stippling
        stippling: true
        # Contour levels for absolute plot
        abs_levs: [1, 5, 10, 50, 100, 500, 1000, 5000, 10000]
        abs_col: "ipcc-ar6_precipitation_seq.rgb"
        # Contour levels for difference plot
        diff_rel: true
        diff_levs: [-0.3, -0.25, -0.2, -0.15, -0.1, -0.05, 0, 0.05, 0.1, 0.15, 0.2, 0.25, 0.3]
        #diff_levs: [-1000., -100., -10., -1., -0.1, 0, 0.1, 1., 10., 100., 1000.]
        diff_col: "ipcc-ar6_precipitation_div.rgb"

#  ### ua: EASTWARD WIND ########################################
#  uaZONAL:
#    description: Eastward wind zonal mean
#    themes:
#      - phys
#    realms:
#      - atmos
#    variables:
#      ua:
#        preprocessor: ppALL
#        reference_dataset: ERA-Interim #ERA5
#        mip: Amon
#        project: CMIP6
#        exp: historical
#        grid: gr
#        ensemble: r1i1p1f1
#        start_year: 1980
#        end_year: 1999
#    scripts:
#      zonal:
#        script: perfmetrics/main.ncl
#        # Plot type ('cycle', 'zonal', 'latlon', 'cycle_latlon', 'cycle_zonal')
#        plot_type: zonal
#        # Time average ('opt' argument of time_operations.ncl)
#        time_avg: annualclim
#        # Region ('global', 'trop', 'nhext', 'shext')
#        region: global
#        # Draw difference plots
#        plot_diff: true
#        # Calculate t-test in difference plots
#        t_test: true
#        # Confidence level for the t-test
#        conf_level: 0.95
#        # Mask non-significant values with stippling
#        stippling: true
#        # Contour levels for absolute plot
#        abs_levs: [-30., -25., -20., -15., -10., -5., 0., 5., 10., 15., 20., 25., 30.]
#        abs_col: "ipcc-ar6_wind_div.rgb"
#        # Contour levels for difference plot
#        diff_levs: [-10, -9, -8, -7, -6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
#        diff_col: "ipcc-ar6_wind_div.rgb"
