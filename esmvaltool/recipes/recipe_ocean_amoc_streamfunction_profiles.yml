# ESMValTool
# recipe_ocean_fig_3_24_amoc.yml

documentation:
  description: |
    Recipe to produce AMOC.

  authors:
    - demora_lee

  references:
    - demora2018gmd

  projects:
    - ukesm

preprocessors:

  prep_transect:
    custom_order: true
    extract_named_regions:
      regions: atlantic_arctic_ocean
    climate_statistics:
       operator: mean
       period: full
    # extract_time:
    #   start_year: 2001
    #   start_month: 1
    #   start_day: 1
    #   end_year: 2003
    #   end_month: 12
    #   end_day: 31

diagnostics:

  # --------------------------------------------------
  # Transect diagnostics
  # --------------------------------------------------
  # diag_transects:
  #   description: Stream function zonal mean
  #   variables:
  #     msftmyz:
  #       short_name: msftmyz
  #       preprocessor: prep_transect
  #       field: TO2M
  #       mip: Omon
  #       exp: historical
  #       start_year: 1900
  #       end_year: 2004
  #
  #   additional_datasets:
  #      # In the original figure they use pre-industrial values here.
  #    - {dataset: CanESM2,          project: CMIP5,    ensemble: r1i1p1}
  #    - {dataset: CCSM4,            project: CMIP5,    ensemble: r1i1p1}
  #    - {dataset: CESM1-BGC,        project: CMIP5,    ensemble: r1i1p1}
  #    - {dataset: CESM1-CAM5-1-FV2, project: CMIP5,    ensemble: r1i1p1}
  #    - {dataset: CESM1-CAM5,       project: CMIP5,    ensemble: r1i1p1}
  #    - {dataset: CESM1-FASTCHEM,   project: CMIP5,    ensemble: r1i1p1}
  #    - {dataset: CESM1-WACCM,      project: CMIP5,    ensemble: r1i1p1}
  #    - {dataset: CNRM-CM5-2,       project: CMIP5,    ensemble: r1i1p1}
  #    - {dataset: CNRM-CM5,         project: CMIP5,    ensemble: r1i1p1}
  #    - {dataset: FGOALS-g2,        project: CMIP5,    ensemble: r1i1p1}
  #    - {dataset: MIROC5,           project: CMIP5,    ensemble: r1i1p1}
  #    - {dataset: MPI-ESM-LR,       project: CMIP5,    ensemble: r1i1p1}
  #    - {dataset: MPI-ESM-MR,       project: CMIP5,    ensemble: r1i1p1}
  #    - {dataset: MPI-ESM-P,        project: CMIP5,    ensemble: r1i1p1}
  #    - {dataset: MRI-CGCM3,        project: CMIP5,    ensemble: r1i1p1}
  #    - {dataset: MRI-ESM1,         project: CMIP5,    ensemble: r1i1p1}
  #    - {dataset: NorESM1-ME,       project: CMIP5,    ensemble: r1i1p1}
  #    - {dataset: NorESM1-M,        project: CMIP5,    ensemble: r1i1p1}
  #    # CMIP6:
  #     # - {dataset: GISS-E2-1-G,      project: CMIP6,    ensemble: r1i1p1f1, grid: gn}
  #
  #   scripts:
  #     Atlantic_Stream_function_zonal_mean:
  #       script: ocean/diagnostic_amoc_profiles.py
  #       thresholds: [-20, -10., 0., 10., 20.]
  #       set_y_logscale: False

  # diag_timeseries_amoc_PI:
  #   description: atlantic_meridional_overturning_circulation
  #   variables:
  #     amoc:
  #       mip: Omon
  #       derive: true
  #       force_derivation: false
  #   additional_datasets:
  #   # CMIP5:
  #     - {dataset: CanESM2,          project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 2015,  end_year: 3020}
  #     - {dataset: CCSM4,            project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 250,  end_year: 1300}
  #     - {dataset: CESM1-BGC,        project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 101,  end_year: 600}
  #       #   - {dataset: CESM1-CAM5-1-FV2, project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
  #   ##   - {dataset: CESM1-CAM5,       project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 10,  end_year: 319}
  #   ##   - {dataset: CESM1-FASTCHEM,   project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 70,  end_year: 291}
  #   ##   - {dataset: CESM1-WACCM,      project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 96,  end_year: 295}
  #   ##   - {dataset: CNRM-CM5-2,       project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
  #     - {dataset: CNRM-CM5,         project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 1850,  end_year: 2699}
  #     - {dataset: FGOALS-g2,        project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 201,  end_year: 900}
  #     # - {dataset: inmcm4,           project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 1850,  end_year: 2349} # Failed to calculate
  #     - {dataset: MIROC5,           project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 2000,  end_year: 2669}
  #     - {dataset: MPI-ESM-LR,       project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 1850,  end_year: 2849}
  #     - {dataset: MPI-ESM-MR,       project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 1850,  end_year: 2849}
  #     - {dataset: MPI-ESM-P,        project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 1850,  end_year: 3005}
  #     - {dataset: MRI-CGCM3,        project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 1851,  end_year: 2350}
  #   #  - {dataset: MRI-ESM1,         project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
  #     - {dataset: NorESM1-ME,       project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 901,  end_year: 1150}
  #     - {dataset: NorESM1-M,        project: CMIP5,    exp: piControl,  ensemble: r1i1p1,  start_year: 700,  end_year: 1200}
  #
  #   # CMIP6:
  #       # rsync -avLP /badc/cmip6/data/CMIP6/CMIP/*/*/piControl/r1i1p1f?/Omon/msftyz//gn/latest/*.nc ledm@pmpc1564.npm.ac.uk:/data/sthenno1/scratch/ledm/CMIP6/msftyz/.
  #   #  - {dataset: GISS-E2-1-G,       project: CMIP6,    exp: piControl,  ensemble: r1i1p1f1,  start_year: 4150,  end_year: 5000, grid: gn}
  #   #  - {dataset: CNRM-CM6-1,        project: CMIP6,    exp: piControl,  ensemble: r1i1p1f2,  start_year: 1850,  end_year: 2394, grid: gn}
  #
  #     - {dataset: HadGEM3-GC31-LL,   project: CMIP6,    exp: piControl,  ensemble: r1i1p1f1,  start_year: 1850,  end_year: 2349, grid: gn}
  #     - {dataset: UKESM1-0-LL,       project: CMIP6,    exp: piControl,  ensemble: r1i1p1f2,  start_year: 1960,  end_year: 3059, grid: gn}
  #
  #   scripts:
  #     AMOC_timeseries:
  #       script: ocean/diagnostic_amoc_timeseries.py
  #       # moving_average: 6 years


  diag_timeseries_amoc_hist:
    variables:
      amoc:
        mip: Omon
        derive: true
        force_derivation: false
        additional_datasets:
          - {dataset: CanESM2,          project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
          - {dataset: CCSM4,            project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
          - {dataset: CESM1-BGC,        project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
          - {dataset: CESM1-CAM5-1-FV2, project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
          - {dataset: CESM1-CAM5,       project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
          - {dataset: CESM1-FASTCHEM,   project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
          - {dataset: CESM1-WACCM,      project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
          - {dataset: CNRM-CM5-2,       project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
          - {dataset: CNRM-CM5,         project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
          - {dataset: FGOALS-g2,        project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
          - {dataset: MIROC5,           project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
          - {dataset: MPI-ESM-LR,       project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
          - {dataset: MPI-ESM-MR,       project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
          - {dataset: MPI-ESM-P,        project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
          - {dataset: MRI-CGCM3,        project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
          - {dataset: MRI-ESM1,         project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
          - {dataset: NorESM1-ME,       project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
          - {dataset: NorESM1-M,        project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}

          - {dataset: CNRM-CM6-1,       project: CMIP6,    exp: historical,  ensemble: r1i1p1f2, grid: gn, start_year: 1860,  end_year: 2014} # rlat probles
          - {dataset: CNRM-ESM2-1,      project: CMIP6,    exp: historical,  ensemble: r1i1p1f2, grid: gn, start_year: 1860,  end_year: 2014} # rlat latitude is wrong
          # - {dataset: EC-Earth3-Veg,    project: CMIP6,    exp: historical,  ensemble: r1i1p1f1, grid: gn, start_year: 1860,  end_year: 2014}
          - {dataset: HadGEM3-GC31-LL,  project: CMIP6,    exp: historical,  ensemble: r1i1p1f3, grid: gn, start_year: 1860,  end_year: 2014}
          - {dataset: IPSL-CM6A-LR,     project: CMIP6,    exp: historical,  ensemble: r1i1p1f1, grid: gn, start_year: 1860,  end_year: 2014} # No grid_latitude field.
          - {dataset: UKESM1-0-LL,      project: CMIP6,    exp: historical,  ensemble: r1i1p1f2, grid: gn, start_year: 1860,  end_year: 2014}

          - {dataset: CanESM5,        project: CMIP6,    exp: historical,  ensemble: r1i1p1f1, grid: gn, start_year: 1860,  end_year: 2014}
          - {dataset: CESM2,          project: CMIP6,    exp: historical,  ensemble: r1i1p1f1, grid: gn, start_year: 1860,  end_year: 2014}
          - {dataset: CESM2-WACCM,    project: CMIP6,    exp: historical,  ensemble: r1i1p1f1, grid: gn, start_year: 1860,  end_year: 2014}
          - {dataset: SAM0-UNICON,    project: CMIP6,    exp: historical,  ensemble: r1i1p1f1, grid: gn, start_year: 1860,  end_year: 2014}
# /badc/cmip6/data/CMIP6/CMIP/EC-Earth-Consortium/EC-Earth3-Veg/historical/r1i1p1f1/Omon/msftyz/

      msftmyz:
        short_name: msftmyz
        preprocessor: prep_transect
        mip: Omon
        exp: historical
        # start_year: 2000
        # end_year: 2004
        additional_datasets:
          - {dataset: CanESM2,          project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          - {dataset: CCSM4,            project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          - {dataset: CESM1-BGC,        project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          - {dataset: CESM1-CAM5-1-FV2, project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          - {dataset: CESM1-CAM5,       project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          - {dataset: CESM1-FASTCHEM,   project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          - {dataset: CESM1-WACCM,      project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          - {dataset: CNRM-CM5-2,       project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          - {dataset: CNRM-CM5,         project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          - {dataset: FGOALS-g2,        project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          - {dataset: MIROC5,           project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          - {dataset: MPI-ESM-LR,       project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          - {dataset: MPI-ESM-MR,       project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          - {dataset: MPI-ESM-P,        project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          - {dataset: MRI-CGCM3,        project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          - {dataset: MRI-ESM1,         project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          - {dataset: NorESM1-ME,       project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          - {dataset: NorESM1-M,        project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1994,  end_year: 2004}
          #CMIP6 
          # - {dataset: GISS-E2-1-G,        project: CMIP6,    exp: historical,  ensemble: r1i1p1f1, grid: gn, start_year: 1994,  end_year: 2014} #msftmyz should be msftyz or msftmz
          #


   # # CMIP6:
      msftyz:
        short_name: msftyz
        preprocessor: prep_transect
        field: TO2M
        mip: Omon
        exp: historical
        # start_year: 2000
        #         # end_year: 2004
        additional_datasets:
        #                     
          # - {dataset: GISS-E2-1-G,        project: CMIP6,    exp: historical,  ensemble: r1i1p1f1, grid: gn, start_year: 1994,  end_year: 2014} #msftmyz
          - {dataset: CNRM-CM6-1,        project: CMIP6,    exp: historical,  ensemble: r1i1p1f2, grid: gn, start_year: 1994,  end_year: 2014} # rlat probles
          - {dataset: CNRM-ESM2-1,        project: CMIP6,    exp: historical,  ensemble: r1i1p1f2, grid: gn, start_year: 1994,  end_year: 2014} #rlat latitude is wrong
          # - {dataset: EC-Earth3-Veg,        project: CMIP6,    exp: historical,  ensemble: r1i1p1f1, grid: gn, start_year: 1994,  end_year: 2014} # does not exist.
          - {dataset: HadGEM3-GC31-LL,        project: CMIP6,    exp: historical,  ensemble: r1i1p1f3, grid: gn, start_year: 1994,  end_year: 2014}
          - {dataset: IPSL-CM6A-LR,        project: CMIP6,    exp: historical,  ensemble: r1i1p1f1, grid: gn, start_year: 1994,  end_year: 2014} # No grid_latitude field.
          - {dataset: UKESM1-0-LL,        project: CMIP6,    exp: historical,  ensemble: r1i1p1f2, grid: gn, start_year: 1994,  end_year: 2014}
      msftmz:
        short_name: msftmz
        preprocessor: prep_transect
        field: TO2M
        mip: Omon
        exp: historical
        additional_datasets:
          # msftmz
          - {dataset: CanESM5,        project: CMIP6,    exp: historical,  ensemble: r1i1p1f1, grid: gn, start_year: 1994,  end_year: 2014}
          - {dataset: CESM2,          project: CMIP6,    exp: historical,  ensemble: r1i1p1f1, grid: gn, start_year: 1994,  end_year: 2014} 
          - {dataset: CESM2-WACCM,    project: CMIP6,    exp: historical,  ensemble: r1i1p1f1, grid: gn, start_year: 1994,  end_year: 2014}
          - {dataset: SAM0-UNICON,    project: CMIP6,    exp: historical,  ensemble: r1i1p1f1, grid: gn, start_year: 1994,  end_year: 2014}
       # rsync -avLP /badc/cmip6/data/CMIP6/CMIP/*/*/piControl/r1i1p1f?/Omon/msftyz//gn/latest/*.nc ledm@pmpc1564.npm.ac.uk:/data/sthenno1/scratch/ledm/CMIP6/msftyz/.


    scripts:
      AMOC_timeseries:
        script: ocean/diagnostic_amoc_profiles.py

#      AMOC_timeseries:
#        script: ocean/diagnostic_timeseries.py
        # moving_average: 6 years
